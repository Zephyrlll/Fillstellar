<!DOCTYPE html>
<!-- ğŸš€ Updated version with Production System 2024-07-10 -->
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Gardener - Production System Update</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.png">
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/examples/jsm/controls/OrbitControls.js": "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js",
          "three/examples/jsm/postprocessing/EffectComposer.js": "https://unpkg.com/three@0.160.0/examples/jsm/postprocessing/EffectComposer.js",
          "three/examples/jsm/postprocessing/RenderPass.js": "https://unpkg.com/three@0.160.0/examples/jsm/postprocessing/RenderPass.js",
          "three/examples/jsm/postprocessing/UnrealBloomPass.js": "https://unpkg.com/three@0.160.0/examples/jsm/postprocessing/UnrealBloomPass.js"
        }
      }
    </script>
</head>
<body>
<script>
    console.log('ğŸŒŸ Cosmic Gardener with Production System loaded!');
    console.log('ğŸ“… Version: 2024-07-10');
</script>

  <!-- ä¸Šéƒ¨ä¸­å¤®ã®æƒ…å ±è¡¨ç¤º -->
  <div id="info-container">
    <div id="year-display">å¹´: <span id="gameYear">0</span></div>
    <div id="thought-speed-display">æ€è€ƒé€Ÿåº¦: <span id="thoughtSpeedMps">0</span> m/s (<span id="lightSpeedPercent">0.00</span>%)</div>
  </div>

  <div id="game-container">
    <canvas id="game-canvas"></canvas>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="message-overlay" class="hidden">
        <p id="message-text"></p>
    </div>

    <!-- ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ä¸­ã®å¤©ä½“è©³ç´° -->
    <div id="focused-celestial-body-details">
        <p id="focused-star-name">ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ä¸­ã®æ˜Ÿã¯ã‚ã‚Šã¾ã›ã‚“</p>
        <div id="star-parameters" class="hidden">
            <p>å¹´é½¢: <span id="focused-star-age">--</span></p>
            <p>æ¸©åº¦: <span id="focused-star-temp">--</span> K</p>
            <p>è³ªé‡: <span id="focused-star-mass">--</span> å¤ªé™½è³ªé‡</p>
            <p>å¯¿å‘½: <span id="focused-star-lifespan">--</span> å„„å¹´</p>
            <p>é€Ÿåº¦: <span id="focused-star-speed">--</span> km/s</p>
        </div>
        <div id="planet-parameters" class="hidden">
            <p>ç¨®é¡: <span id="focused-planet-type">--</span></p>
            <p>è³ªé‡: <span id="focused-planet-mass">--</span> åœ°çƒè³ªé‡</p>
            <p>åŠå¾„: <span id="focused-planet-radius">--</span> åœ°çƒåŠå¾„</p>
            <p>å¤§æ°—: <span id="focused-planet-atmosphere">--</span></p>
            <p>æ°´: <span id="focused-planet-water">--</span></p>
            <p>å±…ä½å¯èƒ½æ€§: <span id="focused-planet-habitability">--</span> %</p>
            <p id="focused-planet-geology-row" style="display: none;">åœ°è³ªæ´»å‹•: <span id="focusedPlanetGeology">--</span> %</p>
            <p>ç”Ÿå‘½: <span id="focused-planet-hasLife">--</span></p>
            <p>ç”Ÿå‘½æ®µéš: <span id="focused-planet-lifeStage">--</span></p>
            <p>äººå£: <span id="focused-planet-population">--</span></p>
            <p>é€Ÿåº¦: <span id="focused-planet-speed">--</span> km/s</p>
        </div>
    </div>

    <!-- å·¦å´ã®UIã‚¨ãƒªã‚¢ -->
    <div id="ui-area">
      <div id="tab-buttons">
        <button id="gameTabButton" class="active-tab">ã‚²ãƒ¼ãƒ </button>
        <button id="researchTabButton">ç ”ç©¶</button>
        <button id="optionsTabButton">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</button>
        <button id="starManagementTabButton">æ’æ˜Ÿç®¡ç†</button>
      </div>
      

      <!-- ã‚²ãƒ¼ãƒ ã‚¿ãƒ– -->
      <div id="game-screen">
        <div id="ui-panel">
          <h1>Cosmic Gardener</h1>
          <div id="resource-display">
             <p>å®‡å®™ã®å¡µ: <span id="resource-cosmicDust">0</span></p>
             <p class="dust-rate">å…¥æ‰‹é€Ÿåº¦: <span id="dustRate">0</span>/ç§’</p>
             <p>ã‚¨ãƒãƒ«ã‚®ãƒ¼: <span id="resource-energy">0</span></p>
             <p>æœ‰æ©Ÿç‰©: <span id="resource-organicMatter">0</span></p>
             <p>ãƒã‚¤ã‚ªãƒã‚¹: <span id="resource-biomass">0</span></p>
             <p>ãƒ€ãƒ¼ã‚¯ãƒã‚¿ãƒ¼: <span id="resource-darkMatter">0</span></p>
             <p>æ€è€ƒãƒã‚¤ãƒ³ãƒˆ: <span id="resource-thoughtPoints">0</span></p>
             <p>å¤©ä½“ã®æ•°: <span id="starCount">0</span></p>
          </div>


          <div class="collapsible-section">
            <div class="collapsible-header active" id="coreActionsHeader">å‰µé€ </div>
            <div class="collapsible-content active" id="coreActionsContent">
              <div class="creation-item">
                  <p>å°æƒ‘æ˜Ÿ (ã‚³ã‚¹ãƒˆ: <span id="asteroidCostDisplay">100</span> å¡µ)</p>
                  <button id="createAsteroidButton">å‰µé€ </button>
              </div>
              <div class="creation-item">
                  <p>å½—æ˜Ÿ (ã‚³ã‚¹ãƒˆ: <span id="cometCostDisplay">500</span> å¡µ)</p>
                  <button id="createCometButton">å‰µé€ </button>
              </div>
              <div class="creation-item">
                  <p>è¡›æ˜Ÿ (ã‚³ã‚¹ãƒˆ: <span id="moonCostDisplay">1000</span> å¡µ)</p>
                  <button id="createMoonButton" style="display: none;">å‰µé€ </button>
              </div>
              <div class="creation-item">
                  <p>æº–æƒ‘æ˜Ÿ (ã‚³ã‚¹ãƒˆ: <span id="dwarfPlanetCostDisplay">2500</span> å¡µ)</p>
                  <button id="createDwarfPlanetButton" style="display: none;">å‰µé€ </button>
              </div>
              <div class="creation-item">
                  <p>æƒ‘æ˜Ÿ (ã‚³ã‚¹ãƒˆ: <span id="planetCostDisplay">10000</span> å¡µ)</p>
                  <button id="createPlanetButton" style="display: none;">å‰µé€ </button>
              </div>
              <div class="creation-item">
                  <p>æ’æ˜Ÿ (ã‚³ã‚¹ãƒˆ: <span id="starCostDisplay">100000</span> å¡µ)</p>
                  <button id="createStarButton" style="display: none;">å‰µé€ </button>
              </div>
            </div>
          </div>

          <div class="collapsible-section">
            <div class="collapsible-header" id="upgradesHeader">ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</div>
            <div class="collapsible-content" id="upgradesContent">
               <div class="upgrade-item">
                    <p>å¡µç”Ÿæˆ Lv: <span id="dustUpgradeLevel">0</span></p>
                    <p>ã‚³ã‚¹ãƒˆ: <span id="dustUpgradeCost">100</span> ã‚¨ãƒãƒ«ã‚®ãƒ¼</p>
                    <button id="upgradeDustButton">ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</button>
                </div>
                <div class="upgrade-item">
                    <p>ãƒ€ãƒ¼ã‚¯ãƒã‚¿ãƒ¼å¤‰æ›å™¨ Lv: <span id="darkMatterConverterLevel">0</span></p>
                    <p>ã‚³ã‚¹ãƒˆ: <span id="darkMatterConverterCost">500</span> ã‚¨ãƒãƒ«ã‚®ãƒ¼</p>
                    <button id="upgradeDarkMatterConverterButton">å¤‰æ›</button>
                </div>
            </div>
          </div>
        </div>
      </div>


      <!-- ç ”ç©¶ã‚¿ãƒ– -->
      <div id="research-screen" class="hidden-screen">
        <div id="ui-panel-research">
            <h1>ç ”ç©¶</h1>
             <div class="research-item">
                <p>å¼·åŒ–ã•ã‚ŒãŸå¡µç”Ÿæˆ (ã‚³ã‚¹ãƒˆ: 1 DM)</p>
                <p>çŠ¶æ…‹: <span id="researchEnhancedDustStatus"></span></p>
                <button id="researchEnhancedDustButton">ç ”ç©¶ã™ã‚‹</button>
            </div>
            <div class="research-item">
                <p>é«˜åº¦ãªã‚¨ãƒãƒ«ã‚®ãƒ¼å¤‰æ› (ã‚³ã‚¹ãƒˆ: 2 DM)</p>
                <p>çŠ¶æ…‹: <span id="researchAdvancedEnergyStatus"></span></p>
                <button id="researchAdvancedEnergyButton">ç ”ç©¶ã™ã‚‹</button>
            </div>
            <div class="research-item">
                <p>è»Œé“åŠ›å­¦ (è¡›æ˜Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯) (ã‚³ã‚¹ãƒˆ: 1 DM)</p>
                <p>çŠ¶æ…‹: <span id="researchMoonStatus"></span></p>
                <button id="researchMoonButton">ç ”ç©¶ã™ã‚‹</button>
            </div>
            <div class="research-item">
                <p>æº–æƒ‘æ˜Ÿå­¦ (æº–æƒ‘æ˜Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯) (ã‚³ã‚¹ãƒˆ: 2 DM)</p>
                <p>çŠ¶æ…‹: <span id="researchDwarfPlanetStatus"></span></p>
                <button id="researchDwarfPlanetButton">ç ”ç©¶ã™ã‚‹</button>
            </div>
            <div class="research-item">
                <p>æƒ‘æ˜Ÿå½¢æˆè«– (æƒ‘æ˜Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯) (ã‚³ã‚¹ãƒˆ: 3 DM)</p>
                <p>çŠ¶æ…‹: <span id="researchPlanetStatus"></span></p>
                <button id="researchPlanetButton">ç ”ç©¶ã™ã‚‹</button>
            </div>
            <div class="research-item">
                <p>æ’æ˜Ÿç™ºç”Ÿè«– (æ’æ˜Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯) (ã‚³ã‚¹ãƒˆ: <span id="researchStarCost">5</span> DM)</p>
                <p>çŠ¶æ…‹: <span id="researchStarStatus"></span></p>
                <button id="researchStarButton">ç ”ç©¶ã™ã‚‹</button>
            </div>
        </div>
      </div>


      <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
      <div id="options-screen" class="hidden-screen">
          <h1>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h1>
          <div id="options-content-wrapper">
              <div class="option-item">
                  <label for="graphicsQualitySelect">ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯å“è³ª:</label>
                  <select id="graphicsQualitySelect">
                      <option value="low">ä½</option>
                      <option value="medium" selected>ä¸­</option>
                      <option value="high">é«˜</option>
                  </select>
              </div>
              <div class="option-item">
                  <label for="unitSystemSelect">å˜ä½ç³»:</label>
                  <select id="unitSystemSelect">
                      <option value="astronomical">å¤©æ–‡å­¦å˜ä½</option>
                      <option value="si">SIå˜ä½</option>
                  </select>
              </div>

              <div class="collapsible-section">
                <div class="collapsible-header" id="timeAccelerationHeader">æ™‚é–“åŠ é€Ÿ</div>
                <div class="collapsible-content" id="timeAccelerationContent">
                    <div class="option-item">
                        <label for="timeMultiplierSelect">ç¾åœ¨ã®å€ç‡:</label>
                        <select id="timeMultiplierSelect">
                            <option value="1">1x</option>
                            <option value="2" disabled>2x</option>
                            <option value="5" disabled>5x</option>
                            <option value="10" disabled>10x</option>
                        </select>
                    </div>
                    <div class="research-item">
                        <p>2x åŠ é€Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯ (ã‚³ã‚¹ãƒˆ: <span id="timeMultiplier2xCost">--</span> TP)</p>
                        <p>çŠ¶æ…‹: <span id="timeMultiplier2xStatus">--</span></p>
                        <button id="timeMultiplier2xButton">ã‚¢ãƒ³ãƒ­ãƒƒã‚¯</button>
                    </div>
                    <div class="research-item">
                        <p>5x åŠ é€Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯ (ã‚³ã‚¹ãƒˆ: <span id="timeMultiplier5xCost">--</span> TP)</p>
                        <p>çŠ¶æ…‹: <span id="timeMultiplier5xStatus">--</span></p>
                        <button id="timeMultiplier5xButton">ã‚¢ãƒ³ãƒ­ãƒƒã‚¯</button>
                    </div>
                    <div class="research-item">
                        <p>10x åŠ é€Ÿã‚¢ãƒ³ãƒ­ãƒƒã‚¯ (ã‚³ã‚¹ãƒˆ: <span id="timeMultiplier10xCost">--</span> TP)</p>
                        <p>çŠ¶æ…‹: <span id="timeMultiplier10xStatus">--</span></p>
                        <button id="timeMultiplier10xButton">ã‚¢ãƒ³ãƒ­ãƒƒã‚¯</button>
                    </div>
                </div>
              </div>

              <div class="collapsible-section">
                <div class="collapsible-header" id="physicsHeader">ç‰©ç†è¨­å®š</div>
                <div class="collapsible-content" id="physicsContent">
                    <div class="option-item">
                        <label for="gravitySlider">ä¸‡æœ‰å¼•åŠ›å®šæ•° G: <span id="gravityValue">100</span></label>
                        <input type="range" id="gravitySlider" min="0" max="1000" value="100" step="1">
                    </div>
                    <div class="option-item">
                        <label for="simulationSpeedSlider">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦: <span id="simulationSpeedValue">1</span>x</label>
                        <input type="range" id="simulationSpeedSlider" min="0.1" max="5" value="1" step="0.1">
                    </div>
                    <div class="option-item">
                        <label for="dragSlider">å®‡å®™æŠµæŠ—: <span id="dragValue">0.01</span></label>
                        <input type="range" id="dragSlider" min="0" max="0.1" value="0.01" step="0.001">
                    </div>
                    <div class="option-item">
                        <label for="collisionDetectionCheckbox">
                            <input type="checkbox" id="collisionDetectionCheckbox" checked>
                            å¤©ä½“è¡çªã‚·ã‚¹ãƒ†ãƒ ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                        </label>
                    </div>
                </div>
              </div>

              <div class="collapsible-section">
                <div class="collapsible-header" id="soundHeader">ã‚µã‚¦ãƒ³ãƒ‰è¨­å®š</div>
                <div class="collapsible-content" id="soundContent">
                    <div class="option-item">
                        <label for="masterVolumeSlider">ãƒã‚¹ã‚¿ãƒ¼éŸ³é‡: <span id="masterVolumeValue">70</span>%</label>
                        <input type="range" id="masterVolumeSlider" min="0" max="100" value="70" step="1">
                    </div>
                    <div class="option-item">
                        <label for="ambientVolumeSlider">ç’°å¢ƒéŸ³: <span id="ambientVolumeValue">60</span>%</label>
                        <input type="range" id="ambientVolumeSlider" min="0" max="100" value="60" step="1">
                    </div>
                    <div class="option-item">
                        <label for="effectsVolumeSlider">åŠ¹æœéŸ³: <span id="effectsVolumeValue">80</span>%</label>
                        <input type="range" id="effectsVolumeSlider" min="0" max="100" value="80" step="1">
                    </div>
                    <div class="option-item">
                        <label for="uiVolumeSlider">UIéŸ³: <span id="uiVolumeValue">50</span>%</label>
                        <input type="range" id="uiVolumeSlider" min="0" max="100" value="50" step="1">
                    </div>
                    <div class="option-item">
                        <label for="spatialAudioCheckbox">
                            <input type="checkbox" id="spatialAudioCheckbox" checked>
                            3Dç©ºé–“éŸ³éŸ¿ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                        </label>
                    </div>
                    <div class="option-item">
                        <button id="muteToggleButton">ãƒŸãƒ¥ãƒ¼ãƒˆ</button>
                    </div>
                    <div class="option-item">
                        <button id="testSoundButton">ã‚µã‚¦ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
                    </div>
                </div>
              </div>

              <div class="collapsible-section">
                  <div class="collapsible-header" id="debugHeader">ãƒ‡ãƒãƒƒã‚°</div>
                  <div class="collapsible-content" id="debugContent">
                      <button id="addAllResourcesButton">å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸€æ‹¬ä»˜ä¸</button>
                      <button id="testCollisionButton">è¡çªãƒ†ã‚¹ãƒˆ</button>
                      <button id="forceCollisionButton">å¼·åˆ¶è¡çªå®Ÿè¡Œ</button>
                      <!-- 
                      <button id="addCosmicDustButton">å¡µã‚’10ä¸‡è¿½åŠ </button>
                      <button id="addEnergyButton">ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’10ä¸‡è¿½åŠ </button>
                      <button id="addDarkMatterButton">DMã‚’10è¿½åŠ </button>
                      -->
                      <button id="resetGameButton">ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                  </div>
              </div>
          </div>
          <button id="closeOptionsButton">é–‰ã˜ã‚‹</button>
      </div>

      <!-- æ’æ˜Ÿç®¡ç†ã‚¿ãƒ– -->
      <div id="star-management-screen" class="hidden-screen">
          <h1>æ’æ˜Ÿç®¡ç†</h1>
          <div id="star-list-container"></div>
      </div>
    </div>

    <!-- å³ä¸‹ã®çµ±è¨ˆæƒ…å ± -->
    <div id="game-stats-overlay">
        <p>å¡µ: <span id="overlayCosmicDust">0</span></p>
        <p>ã‚¨ãƒãƒ«ã‚®ãƒ¼: <span id="overlayEnergy">0</span></p>
        <p>å¤©ä½“: <span id="overlayStarCount">0</span></p>
        <p>TP: <span id="overlayThoughtPoints">0</span></p>
        <p>æ´»ç™ºåº¦: <span id="overlayCosmicActivity">0</span></p>
        <p>äººå£: <span id="overlayPopulation">0</span></p>
        <hr>
        <div class="overlay-currency-section">
            <p>ğŸ’« <span id="overlayCurrencyCosmicDust">0</span></p>
            <p>ğŸ’ <span id="overlayCurrencyGalactic">0</span></p>
            <p>ğŸº <span id="overlayCurrencyAncient">0</span></p>
        </div>
    </div>

    <!-- ãƒ¢ãƒ€ãƒ³ãªãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div id="floating-controls">
        <button id="productionToggleButton" class="floating-btn production-btn" title="ç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ã">
            <div class="btn-icon">ğŸ­</div>
            <div class="btn-label">ç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ </div>
        </button>
        <button id="floatingResourceSellButton" class="floating-btn sell-btn" title="è³‡æºã‚’è²©å£²">
            <div class="btn-icon">ğŸ’°</div>
            <div class="btn-label">è³‡æºè²©å£²</div>
        </button>
    </div>

    <!-- éŠ€æ²³ãƒãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="galaxy-map-container"></div>

    <!-- çµ±è¨ˆãƒ»ãƒ­ã‚°ãƒ‘ãƒãƒ« -->
    <div id="stats-log-container">
      <!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
      <div id="stats-log-tabs">
        <button id="stats-tab-button" class="stats-log-tab active">çµ±è¨ˆ</button>
        <button id="log-tab-button" class="stats-log-tab">ãƒ­ã‚°</button>
        <span id="stats-log-toggle-icon">â–²</span>
      </div>
      
      <!-- çµ±è¨ˆãƒ‘ãƒãƒ« -->
      <div id="statistics-panel">
        <div id="statistics-content">
          <!-- ãƒªã‚½ãƒ¼ã‚¹çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div id="resource-statistics" class="stats-section">
            <h3>ãƒªã‚½ãƒ¼ã‚¹çµ±è¨ˆ</h3>
            <div id="resource-stats-grid"></div>
          </div>
          
          <!-- å®‡å®™çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div id="cosmic-statistics" class="stats-section">
            <h3>å®‡å®™çµ±è¨ˆ</h3>
            <div id="cosmic-stats-grid"></div>
          </div>
          
          <!-- ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div id="chart-section" class="stats-section">
            <h3>ã‚°ãƒ©ãƒ•</h3>
            <div id="chart-tabs">
              <button class="chart-tab active" data-chart="resources">ãƒªã‚½ãƒ¼ã‚¹</button>
              <button class="chart-tab" data-chart="cosmic">å®‡å®™</button>
            </div>
            <canvas id="statistics-chart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- æ™‚ç³»åˆ—ãƒ­ã‚°ãƒ‘ãƒãƒ« -->
      <div id="timeline-log-panel">
        <div id="timeline-log-content">
          <div id="timeline-log-entries"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ç”Ÿç”£ãƒ‘ãƒãƒ«ï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆï¼‰ -->
  <div id="production-panel" class="production-panel">
    <div class="production-panel-header">
      <h1>ğŸ­ è³‡æºç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ </h1>
      <button id="productionPanelCloseButton" class="close-btn">Ã—</button>
    </div>
    
    <div class="production-panel-content">
      <!-- é«˜åº¦ãªè³‡æºåœ¨åº« -->
      <div class="collapsible-section">
        <div class="collapsible-header active" id="advancedResourcesHeader">é«˜åº¦ãªè³‡æº</div>
        <div class="collapsible-content active" id="advancedResourcesContent">
          <div id="advanced-resources-display">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- ãƒªã‚½ãƒ¼ã‚¹å¤‰å‹•ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º -->
      <div class="collapsible-section">
        <div class="collapsible-header active" id="resourceFlowHeader">âš¡ ãƒªã‚½ãƒ¼ã‚¹å¤‰å‹•ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </div>
        <div class="collapsible-content active" id="resourceFlowContent">
          <div id="resource-flow-display">
            <div class="flow-info">
              <p>ğŸ’¡ å¤‰æ›ä¸­ã®ãƒªã‚½ãƒ¼ã‚¹ã®æµã‚Œã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã—ã¾ã™</p>
            </div>
            <div id="active-flows-container">
              <!-- å‹•çš„ã«å¤‰æ›ä¸­ã®ãƒªã‚½ãƒ¼ã‚¹å¤‰å‹•ã‚’è¡¨ç¤º -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- å¤‰æ›ãƒ¬ã‚·ãƒ” -->
      <div class="collapsible-section">
        <div class="collapsible-header active" id="conversionRecipesHeader">å¤‰æ›ãƒ¬ã‚·ãƒ”</div>
        <div class="collapsible-content active" id="conversionRecipesContent">
          <div id="conversion-recipes-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå¤‰æ› -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="activeConversionsHeader">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå¤‰æ›</div>
        <div class="collapsible-content" id="activeConversionsContent">
          <div id="active-conversions-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- ç”Ÿç”£æ–½è¨­ -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="productionFacilitiesHeader">ç”Ÿç”£æ–½è¨­</div>
        <div class="collapsible-content" id="productionFacilitiesContent">
          <div id="production-facilities-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- æ–½è¨­å»ºè¨­ -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="facilityConstructionHeader">æ–½è¨­å»ºè¨­</div>
        <div class="collapsible-content" id="facilityConstructionContent">
          <div id="facility-construction-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- ç”Ÿç”£ãƒã‚§ãƒ¼ãƒ³ -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="productionChainHeader">ğŸ”— ç”Ÿç”£ãƒã‚§ãƒ¼ãƒ³</div>
        <div class="collapsible-content" id="productionChainContent">
          <div class="production-subsection">
            <div id="production-chain-controls">
              <button id="productionChainToggleButton" class="production-chain-btn">
                ğŸ”— ãƒã‚§ãƒ¼ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
              </button>
              <div id="production-chain-info">
                <p>ç”Ÿç”£ãƒã‚§ãƒ¼ãƒ³ã‚’å¯è¦–åŒ–ã—ã¦åŠ¹ç‡çš„ãªè³‡æºãƒ•ãƒ­ãƒ¼ã‚’ç®¡ç†ã—ã¾ã™</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- é«˜åº¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="moduleSystemHeader">ğŸ”§ é«˜åº¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
        <div class="collapsible-content" id="moduleSystemContent">
          
          <!-- Module Shop -->
          <div class="production-subsection">
            <h4>ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è³¼å…¥</h4>
            <div id="module-shop-list">
              <!-- Populated dynamically -->
            </div>
          </div>
          
          <!-- Available Modules -->
          <div class="production-subsection">
            <h4>ğŸ’¼ æ‰€æœ‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</h4>
            <div id="available-modules-list">
              <!-- Populated dynamically -->
            </div>
          </div>
          
          <!-- Facility Module Management -->
          <div class="production-subsection">
            <h4>âš™ï¸ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h4>
            <div id="facility-selector">
              <select id="facilitySelect">
                <option value="">æ–½è¨­ã‚’é¸æŠ...</option>
                <!-- Populated dynamically -->
              </select>
            </div>
            <div id="selected-facility-info" class="hidden">
              <div class="facility-info">
                <h5 id="selectedFacilityName">æ–½è¨­å</h5>
                <div class="facility-slots">
                  ã‚¹ãƒ­ãƒƒãƒˆ: <span id="usedSlots">0</span>/<span id="maxSlots">0</span>
                  <div class="slot-indicator" id="slotIndicator">
                    <!-- Slots populated dynamically -->
                  </div>
                </div>
                
                <div id="installed-modules-section">
                  <h6>è¨­ç½®æ¸ˆã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</h6>
                  <div id="installed-modules-list">
                    <!-- Populated dynamically -->
                  </div>
                </div>
                
                <div id="installable-modules-section">
                  <h6>è¨­ç½®å¯èƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</h6>
                  <div id="installable-modules-list">
                    <!-- Populated dynamically -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Facility Upgrades -->
          <div class="production-subsection">
            <h4>ğŸ­ æ–½è¨­ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h4>
            <div id="facility-upgrades-list">
              <!-- Populated dynamically -->
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="dist/main.js"></script>
  <script type="module">
    console.log('ğŸ”§ Module script loaded');
    try {
      import('./dist/main.js').then(() => {
        console.log('ğŸ”§ main.js imported successfully');
      }).catch(error => {
        console.error('ğŸ”§ Failed to import main.js:', error);
      });
    } catch (error) {
      console.error('ğŸ”§ Error importing main.js:', error);
    }
  </script>
  <script>
    console.log('ğŸ”§ HTML loaded, checking basic functionality...');
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ”§ DOM fully loaded');
      const btn = document.getElementById('overlayResourceSellButton');
      console.log('ğŸ”§ Button element:', btn);
      
      if (btn) {
        btn.addEventListener('click', () => {
          console.log('ğŸ”§ Button clicked via direct HTML listener!');
          // Try to call the modal function directly
          try {
            if (window.showResourceSellModal) {
              window.showResourceSellModal();
            } else {
              console.log('ğŸ”§ showResourceSellModal not available on window');
              // Create a simple modal as fallback
              const modal = document.createElement('div');
              modal.style.position = 'fixed';
              modal.style.top = '0';
              modal.style.left = '0';
              modal.style.width = '100%';
              modal.style.height = '100%';
              modal.style.background = 'rgba(0,0,0,0.8)';
              modal.style.zIndex = '10000';
              modal.style.display = 'flex';
              modal.style.justifyContent = 'center';
              modal.style.alignItems = 'center';
              modal.innerHTML = '<div style="background:white; padding:20px; border-radius:10px;"><h3>è³‡æºè²©å£²</h3><p>é€šè²¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</p><button onclick="this.parentElement.parentElement.remove()">é–‰ã˜ã‚‹</button></div>';
              document.body.appendChild(modal);
            }
          } catch (error) {
            console.error('ğŸ”§ Error calling modal:', error);
            alert('ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¨ãƒ©ãƒ¼: ' + error.message);
          }
        });
        console.log('ğŸ”§ Direct event listener added');
      }
    });
  </script>
  <script>
    // Quick debug: Direct panel test
    document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸ”§ DOM loaded, checking production panel...');
        
        const productionButton = document.getElementById('productionToggleButton');
        const productionPanel = document.getElementById('production-panel');
        
        console.log('ğŸ”§ Button:', !!productionButton);
        console.log('ğŸ”§ Panel:', !!productionPanel);
        
        if (productionButton && productionPanel) {
            productionButton.addEventListener('click', () => {
                console.log('ğŸ”§ Button clicked!');
                productionPanel.classList.toggle('active');
                console.log('ğŸ”§ Panel classes:', productionPanel.className);
            });
        }
    });
    
    document.addEventListener('DOMContentLoaded', () => {
        const iconMap = {
            'cosmicDust': 'icon/å®‡å®™ã®å¡µ.JPG',
            'energy': 'icon/ã‚¨ãƒãƒ«ã‚®ãƒ¼.PNG',
            'organicMatter': 'icon/æœ‰æ©Ÿç‰©.JPG',
            'biomass': 'icon/ãƒã‚¤ã‚ªãƒã‚¹.JPG',
            'darkMatter': 'icon/ãƒ€ãƒ¼ã‚¯ãƒã‚¿ãƒ¼.JPG',
            'thoughtPoints': 'icon/æ€è€ƒãƒã‚¤ãƒ³ãƒˆ.JPG',
            'overlayCosmicDust': 'icon/å®‡å®™ã®å¡µ.JPG',
            'overlayEnergy': 'icon/ã‚¨ãƒãƒ«ã‚®ãƒ¼.PNG',
            'overlayDarkMatter': 'icon/ãƒ€ãƒ¼ã‚¯ãƒã‚¿ãƒ¼.JPG',
            'overlayThoughtPoints': 'icon/æ€è€ƒãƒã‚¤ãƒ³ãƒˆ.JPG'
        };

        for (const [id, src] of Object.entries(iconMap)) {
            const element = document.getElementById(id);
            if (element) {
                const parentP = element.parentElement;
                if (parentP && !parentP.querySelector('.resource-icon')) {
                    const img = document.createElement('img');
                    img.src = src;
                    img.classList.add('resource-icon');
                    // --- ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç›´æ¥æŒ‡å®š ---
                    const isOverlay = id.startsWith('overlay');
                    img.style.width = isOverlay ? '16px' : '20px';
                    img.style.height = isOverlay ? '16px' : '20px';
                    img.style.marginRight = isOverlay ? '5px' : '8px';
                    img.style.objectFit = 'contain';
                    // -------------------------
                    parentP.prepend(img);
                }
            }
        }
    });

    // Stats/Log Panel Logic
    document.addEventListener('DOMContentLoaded', () => {
      const statsLogContainer = document.getElementById('stats-log-container');
      const toggleIcon = document.getElementById('stats-log-toggle-icon');
      const statsTab = document.getElementById('stats-tab-button');
      const logTab = document.getElementById('log-tab-button');
      const statsPanel = document.getElementById('statistics-panel');
      const logPanel = document.getElementById('timeline-log-panel');

      // Toggle panel visibility
      if (toggleIcon) {
        toggleIcon.addEventListener('click', () => {
          statsLogContainer.classList.toggle('expanded');
          toggleIcon.textContent = statsLogContainer.classList.contains('expanded') ? 'â–¼' : 'â–²';
        });
      }

      // Switch between tabs
      if (statsTab && logTab && statsPanel && logPanel) {
        statsTab.addEventListener('click', () => {
          statsTab.classList.add('active');
          logTab.classList.remove('active');
          statsPanel.style.display = 'block';
          logPanel.style.display = 'none';
        });

        logTab.addEventListener('click', () => {
          logTab.classList.add('active');
          statsTab.classList.remove('active');
          logPanel.style.display = 'block';
          statsPanel.style.display = 'none';
        });
      }

      // Set initial state
      if (logPanel) {
        logPanel.style.display = 'none';
      }
    });
  </script>
</body>
</html>