<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fillstellar - 3D Space Simulation</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/css/dual-view.css">
    <link rel="stylesheet" href="/css/research-tree.css">
    <link rel="stylesheet" href="/css/path-finder.css">
    <!-- 旧UIスタイル（開発/デバッグ用のみ、2025年2月削除予定） -->
    <script>
        // URLパラメータ ?legacy=true で旧UIスタイルを読み込み可能
        if (new URLSearchParams(window.location.search).get('legacy') === 'true') {
            document.write('<link rel="stylesheet" href="/legacy-ui.css">');
            console.warn('⚠️ 旧UIスタイルが読み込まれています。このスタイルは2025年2月に削除されます。');
        }
    </script>
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="A 3D space simulation idle game where players create and manage cosmic objects from dust to stars">
</head>
<body>

  <!-- 🔧 初期化フェードオーバーレイ -->
  <div id="fade-overlay">
    <div id="loading-content">
      <h1>Fillstellar</h1>
    </div>
  </div>

  <!-- モバイル専用ナビゲーションバー -->
  <div id="mobile-nav-bar">
    <div id="mobile-nav-left">
      <div id="year-display-nav">年: <span id="gameYear-nav">0</span></div>
    </div>
    <div id="mobile-nav-center">
      <button id="productionToggleButton-mobile" class="mobile-nav-btn production-btn" title="生産システムを開く">
        🏭
      </button>
      <button id="productionChainToggleButton-mobile" class="mobile-nav-btn chain-visualizer-btn" title="生産チェーンビジュアライザー">
        📊
      </button>
      <button id="batchConversionToggleButton-mobile" class="mobile-nav-btn batch-conversion-btn" title="バッチ変換システム">
        🏭
      </button>
      <button id="floatingResourceSellButton-mobile" class="mobile-nav-btn sell-btn" title="資源を販売">
        💰
      </button>
      <button id="researchLabToggleButton-mobile" class="mobile-nav-btn research-lab-btn" title="研究室を開く">
        🔬
      </button>
      <button id="inventoryToggleButton-mobile" class="mobile-nav-btn inventory-btn" title="インベントリを開く">
        📦
      </button>
    </div>
    <div id="mobile-nav-right">
      <div id="resource-summary-nav">
        <span id="dust-nav">塵: <span id="dust-value-nav">0</span></span>
        <button id="mobile-info-toggle" class="mobile-info-btn">ℹ️</button>
      </div>
    </div>
  </div>

  <!-- モバイル専用タブナビゲーション -->
  <div id="mobile-tab-nav">
    <button id="gameTab-mobile" class="mobile-tab active-mobile-tab">ゲーム</button>
    <button id="researchTab-mobile" class="mobile-tab">研究</button>
    <button id="optionsTab-mobile" class="mobile-tab">設定</button>
    <button id="starTab-mobile" class="mobile-tab">恒星</button>
  </div>

  <!-- モバイル専用コンテンツエリア -->
  <div id="mobile-content-area">
    <div id="mobile-game-content" class="mobile-content active-mobile-content">
      <div class="mobile-content-header">
        <h3>🎮 ゲーム</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <!-- 天体創造セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">⭐ 天体創造</h4>
          <div class="mobile-creation-grid">
            <div class="mobile-creation-item">
              <div class="creation-info">
                <span class="creation-name">小惑星</span>
                <span class="creation-cost">コスト: <span id="mobile-asteroidCost">100</span> 塵</span>
              </div>
              <button id="mobile-createAsteroidButton" class="mobile-create-btn">創造</button>
            </div>
            <div class="mobile-creation-item">
              <div class="creation-info">
                <span class="creation-name">彗星</span>
                <span class="creation-cost">コスト: <span id="mobile-cometCost">500</span> 塵</span>
              </div>
              <button id="mobile-createCometButton" class="mobile-create-btn">創造</button>
            </div>
            <div class="mobile-creation-item" id="mobile-moonCreation" style="display: none;">
              <div class="creation-info">
                <span class="creation-name">衛星</span>
                <span class="creation-cost">コスト: <span id="mobile-moonCost">1000</span> 塵</span>
              </div>
              <button id="mobile-createMoonButton" class="mobile-create-btn">創造</button>
            </div>
            <div class="mobile-creation-item" id="mobile-dwarfPlanetCreation" style="display: none;">
              <div class="creation-info">
                <span class="creation-name">準惑星</span>
                <span class="creation-cost">コスト: <span id="mobile-dwarfPlanetCost">2500</span> 塵</span>
              </div>
              <button id="mobile-createDwarfPlanetButton" class="mobile-create-btn">創造</button>
            </div>
            <div class="mobile-creation-item" id="mobile-planetCreation" style="display: none;">
              <div class="creation-info">
                <span class="creation-name">惑星</span>
                <span class="creation-cost">コスト: <span id="mobile-planetCost">10000</span> 塵</span>
              </div>
              <button id="mobile-createPlanetButton" class="mobile-create-btn">創造</button>
            </div>
            <div class="mobile-creation-item" id="mobile-starCreation">
              <div class="creation-info">
                <span class="creation-name">恒星</span>
                <span class="creation-cost">コスト: <span id="mobile-starCost">100000</span> 塵</span>
              </div>
              <button id="mobile-createStarButton" class="mobile-create-btn">創造</button>
            </div>
          </div>
        </div>
        
        <!-- アップグレードセクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🔧 アップグレード</h4>
          <div class="mobile-upgrade-grid">
            <div class="mobile-upgrade-item">
              <div class="upgrade-info">
                <span class="upgrade-name">塵生成</span>
                <span class="upgrade-level">Lv: <span id="mobile-dustUpgradeLevel">0</span></span>
                <span class="upgrade-cost">コスト: <span id="mobile-dustUpgradeCost">100</span> エネルギー</span>
              </div>
              <button id="mobile-upgradeDustButton" class="mobile-upgrade-btn">アップグレード</button>
            </div>
            <div class="mobile-upgrade-item">
              <div class="upgrade-info">
                <span class="upgrade-name">ダークマター変換器</span>
                <span class="upgrade-level">Lv: <span id="mobile-darkMatterConverterLevel">0</span></span>
                <span class="upgrade-cost">コスト: <span id="mobile-darkMatterConverterCost">500</span> エネルギー</span>
              </div>
              <button id="mobile-upgradeDarkMatterConverterButton" class="mobile-upgrade-btn">変換</button>
            </div>
          </div>
        </div>
        
        <!-- 天体情報セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🌌 天体情報</h4>
          <div class="mobile-stats-grid">
            <div class="mobile-stat-item">
              <span class="stat-label">天体数:</span>
              <span class="stat-value" id="mobile-celestialBodyCount">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">恒星数:</span>
              <span class="stat-value" id="mobile-starCountDisplay">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">惑星数:</span>
              <span class="stat-value" id="mobile-planetCountDisplay">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">生命体数:</span>
              <span class="stat-value" id="mobile-lifeCountDisplay">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="mobile-research-content" class="mobile-content">
      <div class="mobile-content-header">
        <h3>🔬 研究</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <div id="mobile-research-items">
          <!-- 基礎研究 -->
          <div class="mobile-research-category">
            <h4 class="research-category-title">基礎研究</h4>
            
            <div class="mobile-research-item" data-research="enhancedDust">
              <div class="research-item-header">
                <div class="research-item-icon">💫</div>
                <div class="research-item-info">
                  <h5 class="research-item-title">強化された塵生成</h5>
                  <p class="research-item-description">宇宙の塵の生成効率を向上させる</p>
                </div>
                <div class="research-item-status">
                  <span id="mobile-researchEnhancedDustStatus" class="research-status-badge">未完了</span>
                </div>
              </div>
              <div class="research-item-footer">
                <div class="research-cost">
                  <img src="icon/dark-matter.JPG" class="cost-icon" alt="DM">
                  <span class="cost-amount">1</span>
                </div>
                <button id="mobile-researchEnhancedDustButton" class="research-button">研究する</button>
              </div>
            </div>

            <div class="mobile-research-item" data-research="advancedEnergy">
              <div class="research-item-header">
                <div class="research-item-icon">⚡</div>
                <div class="research-item-info">
                  <h5 class="research-item-title">高度なエネルギー変換</h5>
                  <p class="research-item-description">エネルギー変換効率を2倍に向上</p>
                </div>
                <div class="research-item-status">
                  <span id="mobile-researchAdvancedEnergyStatus" class="research-status-badge">未完了</span>
                </div>
              </div>
              <div class="research-item-footer">
                <div class="research-cost">
                  <img src="icon/dark-matter.JPG" class="cost-icon" alt="DM">
                  <span class="cost-amount">2</span>
                </div>
                <button id="mobile-researchAdvancedEnergyButton" class="research-button">研究する</button>
              </div>
            </div>
          </div>

          <!-- 天体研究 -->
          <div class="mobile-research-category">
            <h4 class="research-category-title">天体研究</h4>
            
            <div class="mobile-research-item" data-research="moon">
              <div class="research-item-header">
                <div class="research-item-icon">🌙</div>
                <div class="research-item-info">
                  <h5 class="research-item-title">軌道力学</h5>
                  <p class="research-item-description">衛星の作成をアンロック</p>
                </div>
                <div class="research-item-status">
                  <span id="mobile-researchMoonStatus" class="research-status-badge">未完了</span>
                </div>
              </div>
              <div class="research-item-footer">
                <div class="research-cost">
                  <img src="icon/dark-matter.JPG" class="cost-icon" alt="DM">
                  <span class="cost-amount">1</span>
                </div>
                <button id="mobile-researchMoonButton" class="research-button">研究する</button>
              </div>
            </div>

            <div class="mobile-research-item" data-research="dwarfPlanet">
              <div class="research-item-header">
                <div class="research-item-icon">🪨</div>
                <div class="research-item-info">
                  <h5 class="research-item-title">準惑星学</h5>
                  <p class="research-item-description">準惑星の作成をアンロック</p>
                </div>
                <div class="research-item-status">
                  <span id="mobile-researchDwarfPlanetStatus" class="research-status-badge">未完了</span>
                </div>
              </div>
              <div class="research-item-footer">
                <div class="research-cost">
                  <img src="icon/dark-matter.JPG" class="cost-icon" alt="DM">
                  <span class="cost-amount">2</span>
                </div>
                <button id="mobile-researchDwarfPlanetButton" class="research-button">研究する</button>
              </div>
            </div>

            <div class="mobile-research-item" data-research="planet">
              <div class="research-item-header">
                <div class="research-item-icon">🪐</div>
                <div class="research-item-info">
                  <h5 class="research-item-title">惑星形成論</h5>
                  <p class="research-item-description">惑星の作成をアンロック</p>
                </div>
                <div class="research-item-status">
                  <span id="mobile-researchPlanetStatus" class="research-status-badge">未完了</span>
                </div>
              </div>
              <div class="research-item-footer">
                <div class="research-cost">
                  <img src="icon/dark-matter.JPG" class="cost-icon" alt="DM">
                  <span class="cost-amount">3</span>
                </div>
                <button id="mobile-researchPlanetButton" class="research-button">研究する</button>
              </div>
            </div>

            <div class="mobile-research-item" data-research="star">
              <div class="research-item-header">
                <div class="research-item-icon">⭐</div>
                <div class="research-item-info">
                  <h5 class="research-item-title">恒星発生論</h5>
                  <p class="research-item-description">恒星の作成をアンロック</p>
                </div>
                <div class="research-item-status">
                  <span id="mobile-researchStarStatus" class="research-status-badge">未完了</span>
                </div>
              </div>
              <div class="research-item-footer">
                <div class="research-cost">
                  <img src="icon/dark-matter.JPG" class="cost-icon" alt="DM">
                  <span class="cost-amount">5</span>
                </div>
                <button id="mobile-researchStarButton" class="research-button">研究する</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="mobile-options-content" class="mobile-content">
      <div class="mobile-content-header">
        <h3>⚙️ 設定</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <!-- グラフィック設定セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🎮 グラフィック設定</h4>
          
          <!-- パフォーマンス表示 -->
          <div class="mobile-performance-display">
            <div class="performance-row">
              <span class="perf-label">FPS:</span>
              <span class="perf-value" id="mobile-fpsDisplay">60</span>
            </div>
            <div class="performance-row">
              <span class="perf-label">フレーム時間:</span>
              <span class="perf-value" id="mobile-frameTimeDisplay">16.7ms</span>
            </div>
            <div class="performance-row">
              <span class="perf-label">メモリ:</span>
              <span class="perf-value" id="mobile-memoryDisplay">0MB</span>
            </div>
          </div>
          
          <!-- デフォルト設定ボタン -->
          <div class="mobile-setting-item">
            <button id="mobile-setDefaultGraphicsButton" class="mobile-action-btn secondary">デフォルト設定を適用</button>
          </div>
          
          <!-- 解像度スケール -->
          <div class="mobile-setting-item">
            <label class="setting-label">解像度スケール:</label>
            <select id="mobile-resolutionScaleSelect" class="mobile-select">
              <option value="50">50% (パフォーマンス)</option>
              <option value="75">75% (バランス)</option>
              <option value="100" selected>100% (標準)</option>
              <option value="125">125% (高品質)</option>
              <option value="200">200% (最高品質)</option>
            </select>
            <div id="mobile-resolution-hint" class="mobile-setting-hint">
              💡 解像度スケールを選択してください
            </div>
          </div>
          
          <!-- パーティクル密度 -->
          <div class="mobile-setting-item">
            <label class="setting-label">パーティクル密度:</label>
            <select id="mobile-particleDensitySelect" class="mobile-select">
              <option value="25">25% (軽い)</option>
              <option value="50">50% (標準)</option>
              <option value="75" selected>75% (重い)</option>
              <option value="100">100% (最高)</option>
            </select>
          </div>
          
          <!-- フレームレート制限 -->
          <div class="mobile-setting-item">
            <label class="setting-label">フレームレート制限:</label>
            <select id="mobile-frameRateLimitSelect" class="mobile-select">
              <option value="30" selected>30 FPS</option>
              <option value="60">60 FPS</option>
              <option value="-1">無制限</option>
            </select>
          </div>
          
          <!-- ポストプロセッシング -->
          <div class="mobile-setting-item">
            <label class="setting-label">ポストプロセッシング:</label>
            <select id="mobile-postProcessingSelect" class="mobile-select">
              <option value="ultra">ウルトラ</option>
              <option value="high" selected>高</option>
              <option value="medium">中</option>
              <option value="low">低</option>
              <option value="off">オフ</option>
            </select>
          </div>
          
          <!-- 描画距離 -->
          <div class="mobile-setting-item">
            <label class="setting-label">描画距離:</label>
            <select id="mobile-viewDistanceSelect" class="mobile-select">
              <option value="unlimited">無制限</option>
              <option value="far" selected>遠距離</option>
              <option value="medium">中距離</option>
              <option value="near">近距離</option>
              <option value="minimal">最小</option>
            </select>
          </div>
          
          <!-- 背景銀河 -->
          <div class="mobile-setting-item">
            <label class="setting-label">背景銀河:</label>
            <select id="mobile-backgroundGalaxySelect" class="mobile-select">
              <option value="none">なし</option>
              <option value="skybox">グラデーションのみ</option>
              <option value="sprites">銀河スプライト（低品質）</option>
              <option value="mixed" selected>グラデーション＋星雲</option>
            </select>
          </div>
        </div>
        
        <!-- サウンド設定セクション -->
        <div class="mobile-section" style="display: none;">
          <h4 class="mobile-section-title">🔊 サウンド設定</h4>
          
          <!-- マスター音量 -->
          <div class="mobile-setting-item">
            <label class="setting-label">マスター音量: <span id="mobile-masterVolumeValue">70</span>%</label>
            <div class="mobile-slider-container">
              <input type="range" id="mobile-masterVolumeSlider" class="mobile-slider" min="0" max="100" value="70" step="1">
            </div>
          </div>
          
          <!-- 環境音 -->
          <div class="mobile-setting-item">
            <label class="setting-label">環境音: <span id="mobile-ambientVolumeValue">60</span>%</label>
            <div class="mobile-slider-container">
              <input type="range" id="mobile-ambientVolumeSlider" class="mobile-slider" min="0" max="100" value="60" step="1">
            </div>
          </div>
          
          <!-- 効果音 -->
          <div class="mobile-setting-item">
            <label class="setting-label">効果音: <span id="mobile-effectsVolumeValue">80</span>%</label>
            <div class="mobile-slider-container">
              <input type="range" id="mobile-effectsVolumeSlider" class="mobile-slider" min="0" max="100" value="80" step="1">
            </div>
          </div>
          
          <!-- 3D音響 -->
          <div class="mobile-setting-item">
            <label class="setting-label checkbox-label">
              <input type="checkbox" id="mobile-spatialAudioCheckbox" class="mobile-checkbox" checked>
              3D空間音響を有効にする
            </label>
          </div>
          
          <!-- ミュートボタン -->
          <div class="mobile-setting-item">
            <button id="mobile-muteToggleButton" class="mobile-action-btn">ミュート</button>
          </div>
        </div>
        
        <!-- ゲーム設定セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">⚙️ ゲーム設定</h4>
          
          <!-- 時間加速 -->
          <div class="mobile-setting-item">
            <label class="setting-label">時間倍率:</label>
            <select id="mobile-timeMultiplierSelect" class="mobile-select">
              <option value="1">1x</option>
              <option value="2" disabled>2x (要アンロック)</option>
              <option value="5" disabled>5x (要アンロック)</option>
              <option value="10" disabled>10x (要アンロック)</option>
            </select>
          </div>
          
          <!-- UIアニメーション -->
          <div class="mobile-setting-item">
            <label class="setting-label">UIアニメーション:</label>
            <select id="mobile-uiAnimationsSelect" class="mobile-select">
              <option value="standard" selected>標準</option>
              <option value="simple">シンプル</option>
              <option value="off">オフ</option>
            </select>
          </div>
          
          <!-- 動的品質調整 -->
          <div class="mobile-setting-item">
            <label class="setting-label checkbox-label">
              <input type="checkbox" id="mobile-dynamicQualityCheckbox" class="mobile-checkbox">
              動的品質調整 (FPS低下時に自動調整)
            </label>
          </div>
          
          <!-- カメラリセット -->
          <div class="mobile-setting-item">
            <button id="mobile-resetCameraButton" class="mobile-action-btn">カメラ位置をリセット</button>
          </div>
          
          <!-- 設定リセット -->
          <div class="mobile-setting-item">
            <button id="mobile-resetGraphicsButton" class="mobile-action-btn secondary">グラフィック設定をリセット</button>
          </div>
        </div>
        
        <!-- セーブ/ロード設定セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">💾 セーブ/ロード</h4>
          
          <!-- セーブボタン -->
          <div class="mobile-setting-item">
            <button id="mobile-saveGameButton" class="mobile-action-btn">💾 ゲームをセーブ</button>
          </div>
          
          <!-- ロードボタン -->
          <div class="mobile-setting-item">
            <button id="mobile-loadGameButton" class="mobile-action-btn">📂 ゲームをロード</button>
          </div>
          
          <!-- 自動セーブ設定 -->
          <div class="mobile-setting-item">
            <label class="mobile-checkbox-label">
              <input type="checkbox" id="mobile-autoSaveCheckbox" checked>
              <span>自動セーブ（30秒ごと）</span>
            </label>
          </div>
          
          <!-- 最終セーブ時刻 -->
          <div class="mobile-setting-item">
            <p class="mobile-save-info">最終セーブ: <span id="mobile-lastSaveTime">未セーブ</span></p>
          </div>
        </div>
      </div>
    </div>
    <div id="mobile-star-content" class="mobile-content">
      <div class="mobile-content-header">
        <h3>⭐ 恒星管理</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <!-- 恒星統計セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">📊 恒星統計</h4>
          <div class="mobile-stats-grid">
            <div class="mobile-stat-item">
              <span class="stat-label">恒星数:</span>
              <span class="stat-value" id="mobile-star-management-count">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">ブラックホール数:</span>
              <span class="stat-value" id="mobile-blackhole-count">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">総質量:</span>
              <span class="stat-value" id="mobile-total-mass">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">平均温度:</span>
              <span class="stat-value" id="mobile-avg-temperature">0K</span>
            </div>
          </div>
        </div>
        
        <!-- 恒星一覧セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🌟 恒星一覧</h4>
          
          <!-- ソート設定 -->
          <div class="mobile-setting-item">
            <label class="setting-label">ソート:</label>
            <select id="mobile-star-sort-select" class="mobile-select">
              <option value="name">名前</option>
              <option value="type">種類</option>
              <option value="mass">質量</option>
              <option value="temperature">温度</option>
              <option value="age">年齢</option>
              <option value="lifespan">寿命</option>
            </select>
          </div>
          
          <!-- 恒星リスト -->
          <div id="mobile-star-list" class="mobile-star-list">
            <div class="mobile-star-empty">
              <p>現在、管理対象の恒星はありません。</p>
            </div>
          </div>
        </div>
        
        <!-- 恒星管理機能セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🔧 管理機能</h4>
          
          <!-- フォーカス情報 -->
          <div class="mobile-focus-info" id="mobile-focus-info">
            <div class="focus-header">
              <span class="focus-title">選択中の恒星</span>
              <span class="focus-name" id="mobile-focus-name">なし</span>
            </div>
            <div class="focus-details" id="mobile-focus-details" style="display: none;">
              <div class="focus-row">
                <span class="focus-label">種類:</span>
                <span class="focus-value" id="mobile-focus-type">-</span>
              </div>
              <div class="focus-row">
                <span class="focus-label">質量:</span>
                <span class="focus-value" id="mobile-focus-mass">-</span>
              </div>
              <div class="focus-row">
                <span class="focus-label">温度:</span>
                <span class="focus-value" id="mobile-focus-temperature">-</span>
              </div>
              <div class="focus-row">
                <span class="focus-label">年齢:</span>
                <span class="focus-value" id="mobile-focus-age">-</span>
              </div>
              <div class="focus-row">
                <span class="focus-label">寿命:</span>
                <span class="focus-value" id="mobile-focus-lifespan">-</span>
              </div>
            </div>
          </div>
          
          <!-- アクションボタン -->
          <div class="mobile-setting-item">
            <button id="mobile-focus-star-button" class="mobile-action-btn" disabled>選択した恒星に移動</button>
          </div>
          
          <div class="mobile-setting-item">
            <button id="mobile-refresh-star-list" class="mobile-action-btn secondary">リストを更新</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- モバイル生産システムコンテンツ -->
    <div id="mobile-production-content" class="mobile-content">
      <div class="mobile-content-header">
        <h3>🏭 生産システム</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <!-- 資源生産セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">📊 資源生産状況</h4>
          <div class="mobile-production-stats">
            <div class="mobile-stat-item">
              <span class="stat-label">宇宙の塵:</span>
              <span class="stat-value" id="mobile-dust-production">+0/s</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">エネルギー:</span>
              <span class="stat-value" id="mobile-energy-production">+0/s</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">有機物:</span>
              <span class="stat-value" id="mobile-organic-production">+0/s</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">バイオマス:</span>
              <span class="stat-value" id="mobile-biomass-production">+0/s</span>
            </div>
          </div>
        </div>
        
        <!-- 生産チェーン管理 -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">⚙️ 生産チェーン</h4>
          <div id="mobile-production-chains" class="mobile-production-chains">
            <p class="mobile-empty-state">アクティブな生産チェーンはありません</p>
          </div>
          <button class="mobile-action-btn" id="mobile-add-production-chain">生産チェーンを追加</button>
        </div>
        
        <!-- 自動化設定 -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🤖 自動化</h4>
          <div class="mobile-setting-item">
            <label>
              <input type="checkbox" id="mobile-auto-production"> 自動生産を有効化
            </label>
          </div>
          <div class="mobile-setting-item">
            <label>
              <input type="checkbox" id="mobile-auto-upgrade"> 自動アップグレード
            </label>
          </div>
          <div class="mobile-setting-item">
            <label for="mobile-production-priority">優先資源:</label>
            <select id="mobile-production-priority">
              <option value="balanced">バランス</option>
              <option value="dust">宇宙の塵</option>
              <option value="energy">エネルギー</option>
              <option value="organic">有機物</option>
              <option value="biomass">バイオマス</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    
    <!-- モバイル販売システムコンテンツ -->
    <div id="mobile-sell-content" class="mobile-content">
      <div class="mobile-content-header">
        <h3>💰 資源販売</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <!-- 市場価格セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">📈 市場価格</h4>
          <div class="mobile-market-prices">
            <div class="mobile-price-item">
              <span class="resource-name">宇宙の塵</span>
              <span class="resource-price" id="mobile-dust-price">1 CP</span>
              <span class="price-trend" id="mobile-dust-trend">→</span>
            </div>
            <div class="mobile-price-item">
              <span class="resource-name">エネルギー</span>
              <span class="resource-price" id="mobile-energy-price">10 CP</span>
              <span class="price-trend" id="mobile-energy-trend">→</span>
            </div>
            <div class="mobile-price-item">
              <span class="resource-name">有機物</span>
              <span class="resource-price" id="mobile-organic-price">100 CP</span>
              <span class="price-trend" id="mobile-organic-trend">→</span>
            </div>
            <div class="mobile-price-item">
              <span class="resource-name">バイオマス</span>
              <span class="resource-price" id="mobile-biomass-price">500 CP</span>
              <span class="price-trend" id="mobile-biomass-trend">→</span>
            </div>
          </div>
        </div>
        
        <!-- 販売インターフェース -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">🛒 資源を販売</h4>
          <div class="mobile-sell-interface">
            <div class="mobile-sell-item">
              <div class="sell-header">
                <span class="resource-name">宇宙の塵</span>
                <span class="resource-amount" id="mobile-dust-amount">0</span>
              </div>
              <div class="sell-controls">
                <input type="range" class="sell-slider" id="mobile-dust-slider" min="0" max="100" value="0">
                <div class="sell-info">
                  <span class="sell-amount" id="mobile-dust-sell-amount">0</span>
                  <span class="sell-value" id="mobile-dust-sell-value">0 CP</span>
                </div>
                <button class="mobile-sell-btn" id="mobile-sell-dust">販売</button>
              </div>
            </div>
            
            <div class="mobile-sell-item">
              <div class="sell-header">
                <span class="resource-name">エネルギー</span>
                <span class="resource-amount" id="mobile-energy-amount">0</span>
              </div>
              <div class="sell-controls">
                <input type="range" class="sell-slider" id="mobile-energy-slider" min="0" max="100" value="0">
                <div class="sell-info">
                  <span class="sell-amount" id="mobile-energy-sell-amount">0</span>
                  <span class="sell-value" id="mobile-energy-sell-value">0 CP</span>
                </div>
                <button class="mobile-sell-btn" id="mobile-sell-energy">販売</button>
              </div>
            </div>
            
            <div class="mobile-sell-item">
              <div class="sell-header">
                <span class="resource-name">有機物</span>
                <span class="resource-amount" id="mobile-organic-amount">0</span>
              </div>
              <div class="sell-controls">
                <input type="range" class="sell-slider" id="mobile-organic-slider" min="0" max="100" value="0">
                <div class="sell-info">
                  <span class="sell-amount" id="mobile-organic-sell-amount">0</span>
                  <span class="sell-value" id="mobile-organic-sell-value">0 CP</span>
                </div>
                <button class="mobile-sell-btn" id="mobile-sell-organic">販売</button>
              </div>
            </div>
            
            <div class="mobile-sell-item">
              <div class="sell-header">
                <span class="resource-name">バイオマス</span>
                <span class="resource-amount" id="mobile-biomass-amount">0</span>
              </div>
              <div class="sell-controls">
                <input type="range" class="sell-slider" id="mobile-biomass-slider" min="0" max="100" value="0">
                <div class="sell-info">
                  <span class="sell-amount" id="mobile-biomass-sell-amount">0</span>
                  <span class="sell-value" id="mobile-biomass-sell-value">0 CP</span>
                </div>
                <button class="mobile-sell-btn" id="mobile-sell-biomass">販売</button>
              </div>
            </div>
          </div>
          
          <!-- 一括販売ボタン -->
          <div class="mobile-action-buttons">
            <button class="mobile-action-btn" id="mobile-sell-all">すべて販売</button>
            <button class="mobile-action-btn secondary" id="mobile-sell-50">50%販売</button>
          </div>
        </div>
        
        <!-- 取引履歴 -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">📜 取引履歴</h4>
          <div id="mobile-trade-history" class="mobile-trade-history">
            <p class="mobile-empty-state">取引履歴はありません</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- モバイル専用コンパクト情報パネル -->
  <div id="mobile-compact-info" class="mobile-compact-panel">
    <div class="compact-info-header">
      <span>詳細情報</span>
      <button id="mobile-compact-close">×</button>
    </div>
    <div class="compact-info-content">
      <div class="compact-info-row">
        <span class="info-label">人口:</span>
        <span id="mobile-population-value">0</span>
      </div>
      <div class="compact-info-row">
        <span class="info-label">有機物:</span>
        <span id="mobile-organic-value">0</span>
      </div>
      <div class="compact-info-row">
        <span class="info-label">バイオマス:</span>
        <span id="mobile-biomass-value">0</span>
      </div>
      <div class="compact-info-row">
        <span class="info-label">思考P:</span>
        <span id="mobile-thought-value">0</span>
      </div>
      <div class="compact-info-row">
        <span class="info-label">ダーク:</span>
        <span id="mobile-dark-value">0</span>
      </div>
      <div class="compact-info-row">
        <span class="info-label">天体数:</span>
        <span id="mobile-star-count">0</span>
      </div>
    </div>
    
    <!-- モバイルインベントリコンテンツ -->
    <div id="mobile-inventory-content" class="mobile-content">
      <div class="mobile-content-header">
        <h3>📦 インベントリ</h3>
        <button class="mobile-close-btn" onclick="closeMobileModal()">×</button>
      </div>
      <div class="mobile-content-body">
        <!-- 資源概要セクション -->
        <div class="mobile-section">
          <h4 class="mobile-section-title">📊 資源概要</h4>
          <div class="mobile-inventory-stats">
            <div class="mobile-stat-item">
              <span class="stat-label">総資源種類:</span>
              <span class="stat-value" id="mobile-total-resource-types">0</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">総価値:</span>
              <span class="stat-value" id="mobile-total-resource-value">0 CP</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">最高品質:</span>
              <span class="stat-value" id="mobile-highest-quality">-</span>
            </div>
            <div class="mobile-stat-item">
              <span class="stat-label">ストレージ使用率:</span>
              <span class="stat-value" id="mobile-storage-usage">0%</span>
            </div>
          </div>
        </div>
        
        <!-- カテゴリータブ -->
        <div class="mobile-inventory-tabs">
          <button class="mobile-inventory-tab active" data-category="basic">
            <span class="tab-icon">⚛️</span>
            <span class="tab-label">基本資源</span>
          </button>
          <button class="mobile-inventory-tab" data-category="advanced">
            <span class="tab-icon">💎</span>
            <span class="tab-label">高度な資源</span>
          </button>
          <button class="mobile-inventory-tab" data-category="processed">
            <span class="tab-icon">⚙️</span>
            <span class="tab-label">加工資源</span>
          </button>
          <button class="mobile-inventory-tab" data-category="special">
            <span class="tab-icon">✨</span>
            <span class="tab-label">特殊資源</span>
          </button>
        </div>
        
        <!-- 資源リスト -->
        <div class="mobile-inventory-list" id="mobile-inventory-list">
          <div class="mobile-resource-item" data-resource="cosmicDust">
            <span class="resource-icon">✨</span>
            <span class="resource-name">宇宙の塵</span>
            <span class="resource-amount" id="mobile-inv-dust">0</span>
          </div>
          
          <div class="mobile-resource-item" data-resource="energy">
            <span class="resource-icon">⚡</span>
            <span class="resource-name">エネルギー</span>
            <span class="resource-amount" id="mobile-inv-energy">0</span>
          </div>
          
          <div class="mobile-resource-item" data-resource="organicMatter">
            <span class="resource-icon">🌱</span>
            <span class="resource-name">有機物</span>
            <span class="resource-amount" id="mobile-inv-organic">0</span>
          </div>
          
          <div class="mobile-resource-item" data-resource="biomass">
            <span class="resource-icon">🌿</span>
            <span class="resource-name">バイオマス</span>
            <span class="resource-amount" id="mobile-inv-biomass">0</span>
          </div>
          
          <div class="mobile-resource-item" data-resource="darkMatter">
            <span class="resource-icon">🌑</span>
            <span class="resource-name">ダークマター</span>
            <span class="resource-amount" id="mobile-inv-dark">0</span>
          </div>
          
          <div class="mobile-resource-item" data-resource="thoughtPoints">
            <span class="resource-icon">💭</span>
            <span class="resource-name">思考ポイント</span>
            <span class="resource-amount" id="mobile-inv-thought">0</span>
          </div>
        </div>
        
        <!-- ソートとフィルター -->
        <div class="mobile-inventory-controls">
          <div class="control-group">
            <label for="mobile-inv-sort">並び替え:</label>
            <select id="mobile-inv-sort">
              <option value="name">名前順</option>
              <option value="amount">数量順</option>
              <option value="value">価値順</option>
              <option value="quality">品質順</option>
            </select>
          </div>
          <div class="control-group">
            <label for="mobile-inv-filter">フィルター:</label>
            <select id="mobile-inv-filter">
              <option value="all">すべて表示</option>
              <option value="available">利用可能</option>
              <option value="rare">レアのみ</option>
              <option value="convertible">変換可能</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 上部中央の情報表示 -->
  <div id="info-container">
    <div id="year-display">年: <span id="gameYear">0</span></div>
    <div id="thought-speed-display">思考速度: <span id="thoughtSpeedMps">0</span> m/s (<span id="lightSpeedPercent">0.00</span>%)</div>
  </div>

  <!-- デバッグボタン -->
  <div id="debug-buttons" style="position: fixed; bottom: 100px; right: 10px; z-index: 10000; display: flex; gap: 5px;">
    <button id="debug-resources-btn" style="
      background: #10b981;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      opacity: 0.8;
    " title="リソースを1000追加">
      +1000 資源
    </button>
    <button id="debug-panel-btn" style="
      background: #3b82f6;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      opacity: 0.8;
    " title="デバッグパネルを開く (F4)">
      デバッグ
    </button>
  </div>

  <!-- デュアルビューシステム -->
  <div id="dual-view-container" class="dual-view-inactive">
    <!-- タブバー -->
    <div id="dual-view-tabs">
      <button class="dual-view-tab active" data-tab="space">
        <span class="tab-icon">🌌</span>
        <span class="tab-label">宇宙</span>
      </button>
      <button class="dual-view-tab" data-tab="production">
        <span class="tab-icon">🏭</span>
        <span class="tab-label">生産システム</span>
      </button>
      <button class="dual-view-tab" data-tab="research">
        <span class="tab-icon">🔬</span>
        <span class="tab-label">研究ツリー</span>
      </button>
      <div class="dual-view-controls">
        <button id="toggle-dual-view" class="dual-view-control-btn" title="デュアルビューを切り替え">
          <span class="control-icon">⚡</span>
        </button>
        <button id="swap-views" class="dual-view-control-btn" title="ビューを入れ替え" style="display: none;">
          <span class="control-icon">🔄</span>
        </button>
        <div class="layout-selector" style="display: none;">
          <select id="layout-ratio">
            <option value="70-30">70% / 30%</option>
            <option value="50-50">50% / 50%</option>
            <option value="30-70">30% / 70%</option>
          </select>
        </div>
      </div>
    </div>
    
    <!-- ビューエリア -->
    <div id="dual-view-content">
      <!-- プライマリビュー -->
      <div id="primary-view" class="view-panel">
        <div id="primary-view-space" class="view-content active">
          <div id="game-container">
            <canvas id="game-canvas"></canvas>
            <!-- 天体の数表示 -->
            <div id="celestialBodyCount" style="position: absolute; bottom: 20px; right: 25%; color: white; font-size: 14px; opacity: 0.8; text-shadow: 0 1px 2px rgba(0,0,0,0.5);"></div>
            
            <!-- フォーカス中の天体詳細 -->
            <div id="focused-celestial-body-details">
                <p id="focused-star-name">フォーカス中の星はありません</p>
                <div id="star-parameters" class="hidden">
                    <p>年齢: <span id="focused-star-age">--</span></p>
                    <p>温度: <span id="focused-star-temp">--</span> K</p>
                    <p>質量: <span id="focused-star-mass">--</span> 太陽質量</p>
                    <p>寿命: <span id="focused-star-lifespan">--</span> 億年</p>
                    <p>速度: <span id="focused-star-speed">--</span> km/s</p>
                    <p>主星との距離: <span id="focused-star-distance">--</span> AU</p>
                </div>
                <div id="planet-parameters" class="hidden">
                    <p>種類: <span id="focused-planet-type">--</span></p>
                    <p>質量: <span id="focused-planet-mass">--</span> 地球質量</p>
                    <p>半径: <span id="focused-planet-radius">--</span> 地球半径</p>
                    <p>大気: <span id="focused-planet-atmosphere">--</span></p>
                    <p>水: <span id="focused-planet-water">--</span></p>
                    <p>居住可能性: <span id="focused-planet-habitability">--</span> %</p>
                    <p id="focused-planet-geology-row" style="display: none;">地質活動: <span id="focusedPlanetGeology">--</span> %</p>
                    <p>生命: <span id="focused-planet-hasLife">--</span></p>
                    <p>生命段階: <span id="focused-planet-lifeStage">--</span></p>
                    <p>人口: <span id="focused-planet-population">--</span></p>
                    <p>速度: <span id="focused-planet-speed">--</span> km/s</p>
                    <p>主星との距離: <span id="focused-planet-distance">--</span> AU</p>
                </div>
            </div>
            
            <!-- メッセージオーバーレイ -->
            <div id="message-overlay" class="hidden">
                <p id="message-text"></p>
            </div>
        </div>
      </div>
      <div id="primary-view-production" class="view-content">
        <!-- 生産チェーンビジュアライザーのコンテンツがここに移動されます -->
      </div>
      <div id="primary-view-research" class="view-content">
        <!-- 研究ツリービジュアライザーのコンテンツがここに移動されます -->
      </div>
    </div>
      
    <!-- セカンダリビュー（デュアルビュー時のみ表示） -->
    <div id="secondary-view" class="view-panel" style="display: none;">
      <div class="secondary-view-header">
        <span class="secondary-title">🌌 宇宙ビュー（ミニ）</span>
      </div>
      <div id="secondary-view-content" class="view-content">
        <canvas id="mini-game-canvas"></canvas>
      </div>
    </div>
  </div>
  </div>





    <!-- DEPRECATED: 旧UIシステムは削除されました。デュアルビューシステムを使用してください -->

    <!-- 銀河マップコンテナ -->
    <button id="galaxy-map-toggle" title="レーダーを開閉" style="display: flex;">📡</button>
    <div id="galaxy-map-container" class="collapsed"></div>

    <!-- 統計・ログパネル -->
    <div id="stats-log-container">
      <!-- タブボタン -->
      <div id="stats-log-tabs">
        <button id="stats-tab-button" class="stats-log-tab active">統計</button>
        <button id="log-tab-button" class="stats-log-tab">ログ</button>
        <span id="stats-log-toggle-icon">▲</span>
      </div>
      
      <!-- 統計パネル -->
      <div id="statistics-panel">
        <div id="statistics-content">
          <!-- リソース統計セクション -->
          <div id="resource-statistics" class="stats-section">
            <h3>リソース統計</h3>
            <div id="resource-stats-grid"></div>
          </div>
          
          <!-- 宇宙統計セクション -->
          <div id="cosmic-statistics" class="stats-section">
            <h3>宇宙統計</h3>
            <div id="cosmic-stats-grid"></div>
          </div>
          
          <!-- グラフセクション -->
          <div id="chart-section" class="stats-section">
            <h3>グラフ</h3>
            <div id="chart-tabs">
              <button class="chart-tab active" data-chart="resources">リソース</button>
              <button class="chart-tab" data-chart="cosmic">宇宙</button>
            </div>
            <canvas id="statistics-chart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- 時系列ログパネル -->
      <div id="timeline-log-panel">
        <div id="timeline-log-content">
          <div id="timeline-log-entries"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 生産パネル（スライドアウト） -->
  <div id="production-panel" class="production-panel">
    <div class="production-panel-header">
      <h1>🏭 資源生産システム</h1>
      <div class="header-buttons">
        <button id="openInventoryFromProduction" class="header-btn inventory-link">📦 インベントリ</button>
        <button id="productionPanelCloseButton" class="close-btn">×</button>
      </div>
    </div>
    
    <div class="production-panel-content">
      <!-- 高度な資源在庫 -->
      <div class="collapsible-section">
        <div class="collapsible-header active" id="advancedResourcesHeader">高度な資源</div>
        <div class="collapsible-content active" id="advancedResourcesContent">
          <div id="advanced-resources-display">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- リソース変動リアルタイム表示 -->
      <div class="collapsible-section">
        <div class="collapsible-header active" id="resourceFlowHeader">⚡ リソース変動リアルタイム</div>
        <div class="collapsible-content active" id="resourceFlowContent">
          <div id="resource-flow-display">
            <div class="flow-info">
              <p>💡 変換中のリソースの流れをリアルタイムで表示します</p>
            </div>
            <div id="active-flows-container">
              <!-- 動的に変換中のリソース変動を表示 -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- 変換レシピ -->
      <div class="collapsible-section">
        <div class="collapsible-header active" id="conversionRecipesHeader">
          変換レシピ
        </div>
        <div class="collapsible-content active" id="conversionRecipesContent">
          <div id="conversion-recipes-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- アクティブな変換 -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="activeConversionsHeader">アクティブな変換</div>
        <div class="collapsible-content" id="activeConversionsContent">
          <div id="active-conversions-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- 生産施設 -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="productionFacilitiesHeader">生産施設</div>
        <div class="collapsible-content" id="productionFacilitiesContent">
          <div id="production-facilities-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- 施設建設 -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="facilityConstructionHeader">施設建設</div>
        <div class="collapsible-content" id="facilityConstructionContent">
          <div id="facility-construction-list">
            <!-- Dynamically populated -->
          </div>
        </div>
      </div>
      
      <!-- 生産チェーン -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="productionChainHeader">🔗 生産チェーン</div>
        <div class="collapsible-content" id="productionChainContent">
          <div class="production-subsection">
            <div id="production-chain-controls">
              <button id="productionChainToggleButton" class="production-chain-btn">
                🔗 チェーン表示切り替え
              </button>
              <div id="production-chain-info">
                <p>生産チェーンを可視化して効率的な資源フローを管理します</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 高度なモジュール -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="moduleSystemHeader">🔧 高度なモジュール</div>
        <div class="collapsible-content" id="moduleSystemContent">
          
          <!-- Module Shop -->
          <div class="production-subsection">
            <h4>📦 モジュール購入</h4>
            <div id="module-shop-list">
              <!-- Populated dynamically -->
            </div>
          </div>
          
          <!-- Available Modules -->
          <div class="production-subsection">
            <h4>💼 所有モジュール</h4>
            <div id="available-modules-list">
              <!-- Populated dynamically -->
            </div>
          </div>
          
          <!-- Facility Module Management -->
          <div class="production-subsection">
            <h4>⚙️ モジュール管理</h4>
            <div id="facility-selector">
              <select id="facilitySelect">
                <option value="">施設を選択...</option>
                <!-- Populated dynamically -->
              </select>
            </div>
            <div id="selected-facility-info" class="hidden">
              <div class="facility-info">
                <h5 id="selectedFacilityName">施設名</h5>
                <div class="facility-slots">
                  スロット: <span id="usedSlots">0</span>/<span id="maxSlots">0</span>
                  <div class="slot-indicator" id="slotIndicator">
                    <!-- Slots populated dynamically -->
                  </div>
                </div>
                
                <div id="installed-modules-section">
                  <h6>設置済みモジュール</h6>
                  <div id="installed-modules-list">
                    <!-- Populated dynamically -->
                  </div>
                </div>
                
                <div id="installable-modules-section">
                  <h6>設置可能モジュール</h6>
                  <div id="installable-modules-list">
                    <!-- Populated dynamically -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Facility Upgrades -->
          <div class="production-subsection">
            <h4>🏭 施設アップグレード</h4>
            <div id="facility-upgrades-list">
              <!-- Populated dynamically -->
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <!-- 研究室UI (フルスクリーンオーバーレイ) -->
  <div id="research-lab-overlay" class="research-lab-overlay">
    <div class="research-lab-container">
      <!-- ヘッダー -->
      <div class="research-lab-header">
        <div class="lab-title">
          <div class="lab-icon">🔬</div>
          <h1>宇宙研究室</h1>
          <div class="lab-subtitle">Cosmic Research Laboratory</div>
        </div>
        <button id="researchLabCloseButton" class="lab-close-btn">
          <span class="close-icon">✕</span>
        </button>
      </div>

      <!-- メインコンテンツ -->
      <div class="research-lab-content">
        <!-- 研究カテゴリータブ -->
        <div class="research-categories">
          <button class="research-category-tab active" data-category="fundamental">基礎研究</button>
          <button class="research-category-tab" data-category="celestial">天体研究</button>
          <button class="research-category-tab" data-category="life">生命研究</button>
          <button class="research-category-tab" data-category="technology">技術研究</button>
          <button class="research-category-tab" data-category="cosmic">宇宙研究</button>
          <button class="research-category-tab" data-category="automation">自動化</button>
        </div>

        <!-- 研究項目表示エリア -->
        <div class="research-items-container">
          <div id="research-items-grid" class="research-items-grid">
            <!-- 動的に研究項目が追加される -->
          </div>
        </div>

        <!-- 研究進捗サイドバー -->
        <div class="research-sidebar">
          <div class="quick-links">
            <button id="openInventoryFromResearch" class="quick-link-btn">
              <span class="link-icon">📦</span>
              <span class="link-text">インベントリを開く</span>
            </button>
          </div>
          <div class="research-progress-section">
            <h3>研究進捗</h3>
            <div class="progress-stats">
              <div class="progress-stat">
                <span class="stat-label">完了済み研究:</span>
                <span class="stat-value" id="completedResearchCount">0</span>
              </div>
              <div class="progress-stat">
                <span class="stat-label">進行中研究:</span>
                <span class="stat-value" id="activeResearchCount">0</span>
              </div>
              <div class="progress-stat">
                <span class="stat-label">研究ポイント:</span>
                <span class="stat-value" id="researchPointsDisplay">0</span>
              </div>
            </div>
          </div>

          <!-- 研究ボーナス -->
          <div class="research-bonuses-section">
            <h3>アクティブボーナス</h3>
            <div id="active-bonuses-list" class="bonuses-list">
              <!-- 動的にボーナスが表示される -->
            </div>
          </div>
        </div>
      </div>

      <!-- フッター情報 -->
      <div class="research-lab-footer">
        <div class="footer-info">
          <span>研究速度: <span id="researchSpeedDisplay">1.0x</span></span>
          <span>次の研究ポイント獲得まで: <span id="nextResearchPointTime">--:--</span></span>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./main.ts"></script>
  <script>
    console.log('🔧 HTML loaded, market system will be handled by events.ts');
    
    // Debug: Test currency button directly
    document.addEventListener('DOMContentLoaded', () => {
        const currencyBtn = document.getElementById('floatingResourceSellButton');
        if (currencyBtn) {
            console.log('🔧 Currency button found');
            currencyBtn.addEventListener('click', () => {
                console.log('🔧 Currency button clicked directly!');
                
                // Wait for modules to load and try multiple times
                const tryShowModal = (attempts = 0) => {
                    if (window.showResourceSellModal) {
                        console.log('🔧 showResourceSellModal found, calling...');
                        window.showResourceSellModal();
                    } else if (attempts < 10) {
                        console.log('🔧 showResourceSellModal NOT found, retrying...', attempts + 1);
                        setTimeout(() => tryShowModal(attempts + 1), 100);
                    } else {
                        console.log('🔧 showResourceSellModal NOT found after retries, showing simple modal...');
                        // Simple fallback modal
                        const modal = document.createElement('div');
                        modal.style.cssText = `
                            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                            background: rgba(0,0,0,0.8); display: flex; align-items: center; 
                            justify-content: center; z-index: 10000;
                        `;
                        modal.innerHTML = `
                            <div style="background: #1a1a2e; padding: 20px; border-radius: 10px; color: white; max-width: 400px;">
                                <h3>🔧 デバッグ: 資源販売システム</h3>
                                <p>モジュールが正しく読み込まれていません</p>
                                <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px; margin-top: 10px;">閉じる</button>
                            </div>
                        `;
                        document.body.appendChild(modal);
                    }
                };
                
                tryShowModal();
            });
        } else {
            console.log('🔧 Currency button NOT found');
        }
        
        // Debug: Try to load all systems directly
        setTimeout(() => {
            console.log('🔧 Attempting direct module imports...');
            
            // Load currency system
            import('./js/currencySystem.ts')
                .then((currencyModule) => {
                    console.log('🔧 currencySystem module loaded:', currencyModule);
                    if (currencyModule.currencyManager) {
                        window.currencyManager = currencyModule.currencyManager;
                        window.currencyManager.initializeCurrencies();
                        console.log('💰 currencyManager manually set and initialized');
                    }
                })
                .catch((error) => {
                    console.error('🔧 Failed to import currencySystem:', error);
                });
            
            // Load market system
            import('./js/marketSystem.ts')
                .then((marketModule) => {
                    console.log('🔧 marketSystem module loaded:', marketModule);
                    if (marketModule.marketSystem) {
                        window.marketSystem = marketModule.marketSystem;
                        window.marketSystem.update();
                        console.log('📈 marketSystem manually set and updated');
                    }
                })
                .catch((error) => {
                    console.error('🔧 Failed to import marketSystem:', error);
                });
            
            // Load modal system
            import('./js/resourceSellModal.ts')
                .then((module) => {
                    console.log('🔧 resourceSellModal module loaded:', module);
                    if (module.showResourceSellModal) {
                        window.showResourceSellModal = module.showResourceSellModal;
                        console.log('🔧 showResourceSellModal manually set on window');
                    }
                })
                .catch((error) => {
                    console.error('🔧 Failed to import resourceSellModal:', error);
                });
        }, 2000);
    });
  </script>
  <script>
    // Quick debug: Direct panel test
    document.addEventListener('DOMContentLoaded', () => {
        console.log('🔧 DOM loaded, checking production panel...');
        
        const productionButton = document.getElementById('productionToggleButton');
        const productionPanel = document.getElementById('production-panel');
        
        console.log('🔧 Button:', !!productionButton);
        console.log('🔧 Panel:', !!productionPanel);
        
        if (productionButton && productionPanel) {
            productionButton.addEventListener('click', () => {
                console.log('🔧 Button clicked!');
                productionPanel.classList.toggle('active');
                console.log('🔧 Panel classes:', productionPanel.className);
            });
        }
    });
    
    document.addEventListener('DOMContentLoaded', () => {
        const iconMap = {
            'cosmicDust': 'icon/cosmic-dust.JPG',
            'energy': 'icon/energy.PNG',
            'organicMatter': 'icon/organic-matter.JPG',
            'biomass': 'icon/biomass.JPG',
            'darkMatter': 'icon/dark-matter.JPG',
            'thoughtPoints': 'icon/thought-points.JPG',
            'overlayCosmicDust': 'icon/cosmic-dust.JPG',
            'overlayEnergy': 'icon/energy.PNG',
            'overlayDarkMatter': 'icon/dark-matter.JPG',
            'overlayThoughtPoints': 'icon/thought-points.JPG'
        };

        for (const [id, src] of Object.entries(iconMap)) {
            const element = document.getElementById(id);
            if (element) {
                const parentP = element.parentElement;
                if (parentP && !parentP.querySelector('.resource-icon')) {
                    const img = document.createElement('img');
                    img.src = src;
                    img.classList.add('resource-icon');
                    // --- スタイルを直接指定 ---
                    const isOverlay = id.startsWith('overlay');
                    img.style.width = isOverlay ? '16px' : '20px';
                    img.style.height = isOverlay ? '16px' : '20px';
                    img.style.marginRight = isOverlay ? '5px' : '8px';
                    img.style.objectFit = 'contain';
                    // -------------------------
                    parentP.prepend(img);
                }
            }
        }
    });

    // Stats/Log Panel Logic
    document.addEventListener('DOMContentLoaded', () => {
      const statsLogContainer = document.getElementById('stats-log-container');
      const toggleIcon = document.getElementById('stats-log-toggle-icon');
      const statsTab = document.getElementById('stats-tab-button');
      const logTab = document.getElementById('log-tab-button');
      const statsPanel = document.getElementById('statistics-panel');
      const logPanel = document.getElementById('timeline-log-panel');

      // Toggle panel visibility
      if (toggleIcon) {
        toggleIcon.addEventListener('click', () => {
          statsLogContainer.classList.toggle('expanded');
          toggleIcon.textContent = statsLogContainer.classList.contains('expanded') ? '▼' : '▲';
        });
      }

      // Switch between tabs
      if (statsTab && logTab && statsPanel && logPanel) {
        statsTab.addEventListener('click', () => {
          statsTab.classList.add('active');
          logTab.classList.remove('active');
          statsPanel.style.display = 'block';
          logPanel.style.display = 'none';
        });

        logTab.addEventListener('click', () => {
          logTab.classList.add('active');
          statsTab.classList.remove('active');
          logPanel.style.display = 'block';
          statsPanel.style.display = 'none';
        });
      }

      // Set initial state
      if (logPanel) {
        logPanel.style.display = 'none';
      }
    });
    
    // Debug: Manual graphics test function
    // Debug: Test save data
    window.testSave = function() {
        console.log('🔍 Testing save data...');
        const savedData = localStorage.getItem('cosmicGardenerState');
        if (savedData) {
            const parsed = JSON.parse(savedData);
            console.log('Saved data:', parsed);
            console.log('Resources in save:', parsed.resources);
            console.log('Research states:', {
                enhancedDust: parsed.researchEnhancedDust,
                advancedEnergy: parsed.researchAdvancedEnergy,
                moon: parsed.unlockedCelestialBodies?.moon,
                planet: parsed.unlockedCelestialBodies?.planet
            });
        } else {
            console.log('No save data found');
        }
        
        // Show current game state
        console.log('Current game state:', gameStateManager.getState());
    };
    
    window.testGraphics = function() {
        console.log('🔧 Testing graphics system...');
        const currentScale = gameStateManager.getState().graphics.resolutionScale;
        console.log('Current resolution scale:', currentScale);
        
        // Try to change resolution scale
        gameStateManager.updateState(state => ({
            ...state,
            graphics: {
                ...state.graphics,
                resolutionScale: 0.5,
                preset: 'custom'
            }
        }));
        
        console.log('After update - resolution scale:', gameStateManager.getState().graphics.resolutionScale);
        
        // Force graphics engine update
        if (window.graphicsEngine) {
            console.log('Forcing graphics engine update...');
            window.graphicsEngine.update();
        } else {
            console.error('Graphics engine not found on window!');
        }
    };
    
    console.log('💡 You can test graphics with: testGraphics()');
    console.log('💡 You can test save with: testSave()');
    
    // Debug graphics state
    window.debugGraphics = function() {
        const state = gameStateManager.getState();
        console.log('Current graphics state:', state.graphics);
        console.log('Resolution scale in state:', state.graphics.resolutionScale);
        
        const slider = document.getElementById('resolutionScaleRange');
        if (slider) {
            console.log('Slider value:', slider.value);
            console.log('Slider value / 100:', slider.value / 100);
        }
        
        // Check if graphics engine is receiving updates
        if (window.graphicsEngine) {
            console.log('Graphics engine exists');
            // Try manual update
            window.graphicsEngine.update();
        }
    };
    console.log('💡 Debug graphics with: debugGraphics()');
    
    // Unregister old service workers to fix caching issues
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister().then(function(success) {
                    if (success) {
                        console.log('🧹 Service Worker unregistered:', registration.scope);
                    }
                });
            }
        });
    }
  </script>

  <!-- インベントリUI (フルスクリーンオーバーレイ) -->
  <div id="inventory-overlay" class="inventory-overlay">
    <div class="inventory-container">
      <!-- ヘッダー -->
      <div class="inventory-header">
        <div class="inventory-title">
          <div class="inventory-icon">📦</div>
          <h1>宇宙インベントリ</h1>
          <div class="inventory-subtitle">Cosmic Inventory</div>
        </div>
        <button id="inventoryCloseButton" class="inventory-close-btn">
          <span class="close-icon">✕</span>
        </button>
      </div>

      <!-- メインコンテンツ -->
      <div class="inventory-main">
        <!-- カテゴリタブ -->
        <div class="inventory-tabs">
          <div class="inventory-tab active" data-category="basic">
            <div class="tab-icon">⚛️</div>
            <div class="tab-label">基本資源</div>
          </div>
          <div class="inventory-tab" data-category="advanced">
            <div class="tab-icon">💎</div>
            <div class="tab-label">高度な資源</div>
          </div>
          <div class="inventory-tab" data-category="processed">
            <div class="tab-icon">⚙️</div>
            <div class="tab-label">加工資源</div>
          </div>
          <div class="inventory-tab" data-category="special">
            <div class="tab-icon">🌟</div>
            <div class="tab-label">特殊資源</div>
          </div>
        </div>

        <!-- リソースグリッド -->
        <div class="inventory-grid" id="inventory-grid">
          <!-- 動的に生成されるリソースカード -->
        </div>
      </div>

      <!-- フッター -->
      <div class="inventory-footer">
        <div class="inventory-stats">
          <div class="stat-item">
            <span class="stat-label">総資源種類:</span>
            <span class="stat-value" id="totalResourceTypes">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">総価値:</span>
            <span class="stat-value" id="totalResourceValue">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">最高品質:</span>
            <span class="stat-value" id="highestQuality">-</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 生産チェーンビジュアライザー (フルスクリーンオーバーレイ) -->
  <div id="production-chain-overlay" class="production-chain-overlay">
    <div class="production-chain-container">
      <!-- ヘッダー -->
      <div class="production-chain-header">
        <div class="chain-title">
          <div class="chain-icon">🏭</div>
          <h1>生産チェーンビジュアライザー</h1>
          <div class="chain-subtitle">Production Chain Visualizer</div>
        </div>
        <button id="productionChainCloseButton" class="chain-close-btn">
          <span class="close-icon">✕</span>
        </button>
      </div>

      <!-- ツールバー -->
      <div class="production-chain-toolbar">
        <!-- モード切替 -->
        <div class="toolbar-section mode-selector">
          <label>表示モード:</label>
          <select id="visualizer-mode-select">
            <option value="simple">シンプル</option>
            <option value="detailed">詳細</option>
            <option value="efficiency">効率</option>
            <option value="bottleneck">ボトルネック</option>
            <option value="quality">品質</option>
          </select>
        </div>

        <!-- レイアウト選択 -->
        <div class="toolbar-section layout-selector">
          <label>レイアウト:</label>
          <select id="visualizer-layout-select">
            <option value="hierarchical">階層</option>
            <option value="force">フォース</option>
            <option value="circular">円形</option>
            <option value="grid">グリッド</option>
          </select>
        </div>

        <!-- オプション -->
        <div class="toolbar-section options">
          <label class="checkbox-label">
            <input type="checkbox" id="show-rates-checkbox" checked>
            <span>レート表示</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="animate-flow-checkbox" checked>
            <span>フローアニメーション</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="highlight-bottlenecks-checkbox" checked>
            <span>ボトルネック強調</span>
          </label>
        </div>

        <!-- アクション -->
        <div class="toolbar-section actions">
          <button id="refresh-chain-btn" class="toolbar-btn">
            <span>🔄</span> 更新
          </button>
          <button id="optimize-chain-btn" class="toolbar-btn">
            <span>⚡</span> 最適化
          </button>
          <button id="export-chain-btn" class="toolbar-btn">
            <span>💾</span> エクスポート
          </button>
        </div>
      </div>

      <!-- メインコンテンツ -->
      <div class="production-chain-content">
        <!-- グラフ表示エリア -->
        <div id="production-chain-graph" class="chain-graph-container">
          <!-- SVGグラフがここに描画される -->
        </div>

        <!-- サイドパネル -->
        <div class="production-chain-sidebar">
          <!-- メトリクス -->
          <div class="chain-metrics-panel">
            <h3>チェーンメトリクス</h3>
            <div class="metrics-list">
              <div class="metric-item">
                <span class="metric-label">全体効率:</span>
                <span class="metric-value" id="chain-efficiency">0%</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">ボトルネック:</span>
                <span class="metric-value" id="bottleneck-count">0</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">アクティブノード:</span>
                <span class="metric-value" id="active-nodes">0</span>
              </div>
            </div>
          </div>

          <!-- 最適化提案 -->
          <div class="chain-suggestions-panel">
            <h3>最適化提案</h3>
            <div id="optimization-suggestions" class="suggestions-list">
              <!-- 動的に提案が追加される -->
            </div>
          </div>

          <!-- 選択ノード詳細 -->
          <div class="chain-details-panel" id="node-details-panel" style="display: none;">
            <h3>ノード詳細</h3>
            <div id="node-details-content">
              <!-- 選択されたノードの詳細が表示される -->
            </div>
          </div>
        </div>
      </div>

      <!-- フッター -->
      <div class="production-chain-footer">
        <div class="footer-stats">
          <span>更新間隔: <span id="update-interval">1.0</span>秒</span>
          <span>最終更新: <span id="last-update-time">--:--:--</span></span>
        </div>
      </div>
    </div>
  </div>

  <!-- 恒星管理パネル -->
  <div id="star-management-container" class="star-management-modern">
    <div id="star-management-panel" class="management-panel-modern">
      <div class="management-content-modern">
        <!-- 中身は後で追加 -->
      </div>
    </div>
    <button id="star-management-toggle" class="management-toggle-modern" title="恒星管理">
      <span class="toggle-text">FIXED STARS<br>Management</span>
    </button>
  </div>

  <!-- 宇宙ビュー用天体創造メニュー (モダン) -->
  <div id="celestial-creation-scroll" class="celestial-creation-modern">
    <button id="celestial-creation-toggle" class="creation-toggle-modern" title="天体創造">
      <span class="toggle-text">CREATE</span>
    </button>
    
    <div id="celestial-creation-menu" class="creation-menu-modern">
      <div class="creation-content-modern">
        <div class="creation-item-modern">
          <div class="item-header">
            <span class="item-name">小惑星</span>
            <span class="item-cost"><span id="scroll-asteroidCost">100</span></span>
          </div>
          <button class="create-btn-modern" data-type="asteroid">生成</button>
        </div>
        
        <div class="creation-item-modern">
          <div class="item-header">
            <span class="item-name">彗星</span>
            <span class="item-cost"><span id="scroll-cometCost">500</span></span>
          </div>
          <button class="create-btn-modern" data-type="comet">生成</button>
        </div>
        
        <div class="creation-item-modern" id="scroll-moonCreation">
          <div class="item-header">
            <span class="item-name">衛星</span>
            <span class="item-cost"><span id="scroll-moonCost">1000</span></span>
          </div>
          <button class="create-btn-modern" data-type="moon">生成</button>
        </div>
        
        <div class="creation-item-modern" id="scroll-dwarfPlanetCreation">
          <div class="item-header">
            <span class="item-name">準惑星</span>
            <span class="item-cost"><span id="scroll-dwarfPlanetCost">2500</span></span>
          </div>
          <button class="create-btn-modern" data-type="dwarfPlanet">生成</button>
        </div>
        
        <div class="creation-item-modern" id="scroll-planetCreation">
          <div class="item-header">
            <span class="item-name">惑星</span>
            <span class="item-cost"><span id="scroll-planetCost">10000</span></span>
          </div>
          <button class="create-btn-modern" data-type="planet">生成</button>
        </div>
        
        <div class="creation-item-modern" id="scroll-starCreation">
          <div class="item-header">
            <span class="item-name">恒星</span>
            <span class="item-cost"><span id="scroll-starCost">100000</span></span>
          </div>
          <button class="create-btn-modern" data-type="star">生成</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 研究ツリービジュアライザー (フルスクリーンオーバーレイ) -->
  <div id="research-tree-overlay" class="research-tree-overlay">
    <div class="research-tree-container">
      <!-- ヘッダー -->
      <div class="research-tree-header">
        <div class="tree-title">
          <div class="tree-icon">🌳</div>
          <h1>研究ツリー</h1>
          <div class="tree-subtitle">Research Technology Tree</div>
        </div>
        <button id="researchTreeCloseButton" class="tree-close-btn">
          <span class="close-icon">✕</span>
        </button>
      </div>

      <!-- ツールバー -->
      <div class="research-tree-toolbar">
        <!-- レイアウト選択 -->
        <div class="toolbar-section layout-selector">
          <label>レイアウト:</label>
          <select id="tree-layout-select">
            <option value="hierarchical">階層型</option>
            <option value="radial">放射状</option>
            <option value="category">カテゴリー別</option>
            <option value="force">フォース</option>
          </select>
        </div>

        <!-- フィルター -->
        <div class="toolbar-section filter-options">
          <label class="checkbox-label">
            <input type="checkbox" id="show-completed-checkbox" checked>
            <span>完了済み表示</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="show-locked-checkbox" checked>
            <span>ロック表示</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="show-costs-checkbox" checked>
            <span>コスト表示</span>
          </label>
        </div>

        <!-- アクション -->
        <div class="toolbar-section actions">
          <button id="center-tree-btn" class="toolbar-btn">
            <span>🎯</span> 中央に戻す
          </button>
          <button id="find-path-btn" class="toolbar-btn">
            <span>🛤️</span> 最適パス
          </button>
          <button id="tree-stats-btn" class="toolbar-btn">
            <span>📊</span> 統計
          </button>
        </div>

        <!-- 検索 -->
        <div class="toolbar-section search-section">
          <input type="text" id="tree-search-input" placeholder="研究を検索..." class="tree-search-input">
        </div>
      </div>

      <!-- メインコンテンツ -->
      <div class="research-tree-content">
        <!-- ツリー表示エリア -->
        <div id="research-tree-graph" class="tree-graph-container">
          <!-- SVGツリーがここに描画される -->
        </div>

        <!-- サイドパネル -->
        <div class="research-tree-sidebar">
          <!-- 統計情報 -->
          <div class="tree-stats-panel">
            <h3>研究進捗</h3>
            <div class="stats-list">
              <div class="stat-item">
                <span class="stat-label">完了済み:</span>
                <span class="stat-value" id="tree-completed-count">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">利用可能:</span>
                <span class="stat-value" id="tree-available-count">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ロック中:</span>
                <span class="stat-value" id="tree-locked-count">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">進捗率:</span>
                <span class="stat-value" id="tree-progress-percent">0%</span>
              </div>
            </div>
          </div>

          <!-- 選択ノード詳細 -->
          <div class="tree-details-panel" id="tree-node-details" style="display: none;">
            <h3>研究詳細</h3>
            <div id="tree-node-content">
              <!-- 選択された研究の詳細が表示される -->
            </div>
          </div>

          <!-- パス提案 -->
          <div class="tree-path-panel" id="tree-path-panel" style="display: none;">
            <h3>推奨研究パス</h3>
            <div id="tree-path-content">
              <!-- 最適パスが表示される -->
            </div>
          </div>

          <!-- カテゴリー凡例 -->
          <div class="tree-legend-panel">
            <h3>カテゴリー</h3>
            <div class="legend-list">
              <div class="legend-item">
                <span class="legend-color" style="background: #4169e1"></span>
                <span>基礎研究</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #10b981"></span>
                <span>天体研究</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #8b5cf6"></span>
                <span>生命研究</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #f59e0b"></span>
                <span>技術研究</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #ec4899"></span>
                <span>宇宙研究</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #06b6d4"></span>
                <span>自動化</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- フッター -->
      <div class="research-tree-footer">
        <div class="footer-info">
          <span>ノード数: <span id="tree-node-count">0</span></span>
          <span>ズーム: <span id="tree-zoom-level">100%</span></span>
          <span class="footer-hint">マウスホイール: ズーム | ドラッグ: 移動 | クリック: 選択</span>
        </div>
      </div>
    </div>
  </div>
</body>
</html>