<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿå±‘ã‚µã‚¤ã‚ºãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: monospace;
        }
        #debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border: 1px solid #4a9eff;
            border-radius: 8px;
            z-index: 1000;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            background: #4a9eff;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #6bb6ff;
        }
        #result {
            margin-top: 15px;
            padding: 10px;
            background: rgba(74, 158, 255, 0.1);
            border-radius: 4px;
            font-family: monospace;
            line-height: 1.5;
        }
    </style>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
        }
      }
    </script>
</head>
<body>
    <div id="debug-panel">
        <h3>ğŸ” æ˜Ÿå±‘ã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ</h3>
        
        <div>
            <label>è§£åƒåº¦ã‚¹ã‚±ãƒ¼ãƒ«:</label>
            <button onclick="testStarfieldSize(0.25)">25%</button>
            <button onclick="testStarfieldSize(0.50)">50%</button>
            <button onclick="testStarfieldSize(0.75)">75%</button>
            <button onclick="testStarfieldSize(1.00)">100%</button>
            <button onclick="testStarfieldSize(1.25)">125%</button>
            <button onclick="testStarfieldSize(1.50)">150%</button>
            <button onclick="testStarfieldSize(2.00)">200%</button>
            <button onclick="testStarfieldSize(3.00)">300%</button>
        </div>
        
        <div style="margin-top: 10px;">
            <button onclick="testCurrentGame()">å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã‹ã‚‰ç¢ºèª</button>
            <button onclick="createTestStarfield()">ãƒ†ã‚¹ãƒˆæ˜Ÿå±‘ä½œæˆ</button>
        </div>
        
        <div id="result">
            ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ˜Ÿå±‘ã‚µã‚¤ã‚ºã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«Threeã‚’è¨­å®š
        window.THREE = THREE;
        
        // Test scene setup
        let scene, camera, renderer, starfield;
        
        function initTestScene() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000011);
            document.body.appendChild(renderer.domElement);
            
            camera.position.z = 500;
            
            console.log('Test scene initialized');
        }
        
        window.createTestStarfield = function() {
            if (!scene) initTestScene();
            
            // Remove existing starfield
            if (starfield) {
                scene.remove(starfield);
            }
            
            // Create simple test starfield
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({ 
                color: 0xffffff, 
                size: 3.2, // Base size
                sizeAttenuation: true,
                transparent: true
            });
            
            const starsVertices = [];
            for (let i = 0; i < 1000; i++) {
                starsVertices.push(
                    (Math.random() - 0.5) * 2000,
                    (Math.random() - 0.5) * 2000,
                    (Math.random() - 0.5) * 2000
                );
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            
            starfield = new THREE.Points(starsGeometry, starsMaterial);
            starfield.name = 'starfield';
            scene.add(starfield);
            
            renderer.render(scene, camera);
            
            updateResult(`ãƒ†ã‚¹ãƒˆæ˜Ÿå±‘ä½œæˆå®Œäº†<br>åˆæœŸã‚µã‚¤ã‚º: ${starsMaterial.size}`);
        }
        
        window.testStarfieldSize = function(scale) {
            if (!starfield) {
                window.createTestStarfield();
            }
            
            const expectedSize = scale * 3.2;
            starfield.material.size = expectedSize;
            
            renderer.render(scene, camera);
            
            updateResult(`
                è§£åƒåº¦ã‚¹ã‚±ãƒ¼ãƒ«: ${Math.round(scale * 100)}%<br>
                è¨­å®šã‚µã‚¤ã‚º: ${expectedSize.toFixed(1)}<br>
                å®Ÿéš›ã®ãƒãƒ†ãƒªã‚¢ãƒ«ã‚µã‚¤ã‚º: ${starfield.material.size}<br>
                æœŸå¾…å€¤ã¨ã®ä¸€è‡´: ${starfield.material.size === expectedSize ? 'âœ…' : 'âŒ'}
            `);
        }
        
        window.testCurrentGame = function() {
            // Try to access main game if in iframe or same origin
            try {
                if (window.parent && window.parent !== window) {
                    // In iframe, try to access parent
                    const parentScene = window.parent.scene;
                    const parentGameState = window.parent.gameState;
                    
                    if (parentScene && parentGameState) {
                        const starfield = parentScene.getObjectByName('starfield');
                        if (starfield && starfield.material && parentGameState.graphics) {
                            const currentScale = parentGameState.graphics.resolutionScale || 1.0;
                            const actualSize = starfield.material.size;
                            const expectedSize = currentScale * 3.2;
                            
                            updateResult(`
                                ã€å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã‹ã‚‰å–å¾—ã€‘<br>
                                ç¾åœ¨ã®è§£åƒåº¦ã‚¹ã‚±ãƒ¼ãƒ«: ${Math.round(currentScale * 100)}%<br>
                                æ˜Ÿå±‘ãƒãƒ†ãƒªã‚¢ãƒ«ã‚µã‚¤ã‚º: ${actualSize}<br>
                                æœŸå¾…å€¤: ${expectedSize.toFixed(1)}<br>
                                æ­£ã—ãå‹•ä½œ: ${Math.abs(actualSize - expectedSize) < 0.1 ? 'âœ…' : 'âŒ'}<br>
                                å·®åˆ†: ${(actualSize - expectedSize).toFixed(2)}
                            `);
                            return;
                        }
                    }
                }
                
                // Try to access via global window
                if (window.top && window.top.scene && window.top.gameState) {
                    const starfield = window.top.scene.getObjectByName('starfield');
                    if (starfield && starfield.material && window.top.gameState.graphics) {
                        const currentScale = window.top.gameState.graphics.resolutionScale || 1.0;
                        const actualSize = starfield.material.size;
                        const expectedSize = currentScale * 3.2;
                        
                        updateResult(`
                            ã€å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã‹ã‚‰å–å¾—ã€‘<br>
                            ç¾åœ¨ã®è§£åƒåº¦ã‚¹ã‚±ãƒ¼ãƒ«: ${Math.round(currentScale * 100)}%<br>
                            æ˜Ÿå±‘ãƒãƒ†ãƒªã‚¢ãƒ«ã‚µã‚¤ã‚º: ${actualSize}<br>
                            æœŸå¾…å€¤: ${expectedSize.toFixed(1)}<br>
                            æ­£ã—ãå‹•ä½œ: ${Math.abs(actualSize - expectedSize) < 0.1 ? 'âœ…' : 'âŒ'}<br>
                            å·®åˆ†: ${(actualSize - expectedSize).toFixed(2)}
                        `);
                        return;
                    }
                }
                
                updateResult(`å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚<br>ã“ã®ãƒšãƒ¼ã‚¸ã‚’ã‚²ãƒ¼ãƒ ã¨åŒã˜ã‚¿ãƒ–ã§é–‹ãã‹ã€<br>ã‚²ãƒ¼ãƒ å†…ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ç›´æ¥ checkStarfieldSize() ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚`);
                
            } catch (error) {
                updateResult(`ã‚²ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}<br>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ã«ã‚ˆã‚Šå®Ÿéš›ã®ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚`);
            }
        }
        
        function updateResult(text) {
            document.getElementById('result').innerHTML = text;
        }
        
        // Initialize on load
        window.addEventListener('load', () => {
            updateResult('ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
        });
    </script>
</body>
</html>