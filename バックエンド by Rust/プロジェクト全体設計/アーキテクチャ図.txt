全体アーキテクチャ

  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                                CLIENT LAYER                                      │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  Web Browser (Three.js)  │  Mobile App (React Native)  │  Desktop App (Tauri)  │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                              LOAD BALANCER                                       │
  │                                  (nginx)                                        │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                            PRESENTATION LAYER                                   │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │    REST API         │  │    WebSocket        │  │    GraphQL          │     │
  │  │                     │  │                     │  │    (Future)         │     │
  │  │  - Auth             │  │  - Real-time        │  │  - Complex Queries  │     │
  │  │  - Game Actions     │  │  - Physics Updates  │  │  - Batch Operations │     │
  │  │  - Statistics       │  │  - Chat             │  │                     │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                            APPLICATION LAYER                                    │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │    Commands         │  │    Queries          │  │    Services         │     │
  │  │                     │  │                     │  │                     │     │
  │  │  - Create Body      │  │  - Get Game State   │  │  - Game Service     │     │
  │  │  - Update Resources │  │  - Get Statistics   │  │  - Physics Service  │     │
  │  │  - Evolve Life      │  │  - Get Leaderboard  │  │  - Anti-Cheat       │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                              DOMAIN LAYER                                       │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │    Entities         │  │    Value Objects    │  │    Domain Services  │     │
  │  │                     │  │                     │  │                     │     │
  │  │  - Player           │  │  - Position         │  │  - Physics Rules    │     │
  │  │  - CelestialBody    │  │  - Resources        │  │  - Life Evolution   │     │
  │  │  - GameState        │  │  - Velocity         │  │  - Resource Calc    │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                          INFRASTRUCTURE LAYER                                   │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │    Persistence      │  │    External APIs    │  │    System Services  │     │
  │  │                     │  │                     │  │                     │     │
  │  │  - PostgreSQL       │  │  - Auth Provider    │  │  - Message Queue    │     │
  │  │  - Redis Cache      │  │  - Metrics Service  │  │  - File Storage     │     │
  │  │  - Repository Impl  │  │  - Notification     │  │  - Logging          │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘

  データフロー図

  ┌─────────────┐    HTTP/WS     ┌─────────────────┐
  │   Client    │ ────────────→  │  Load Balancer  │
  └─────────────┘                └─────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                              API GATEWAY                                        │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │   Rate Limiting     │  │   Authentication    │  │   Request Routing   │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                            GAME SERVER CLUSTER                                  │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │   Game Server 1     │  │   Game Server 2     │  │   Game Server N     │     │
  │  │                     │  │                     │  │                     │     │
  │  │  - WebSocket Pool   │  │  - WebSocket Pool   │  │  - WebSocket Pool   │     │
  │  │  - Physics Engine   │  │  - Physics Engine   │  │  - Physics Engine   │     │
  │  │  - Anti-Cheat       │  │  - Anti-Cheat       │  │  - Anti-Cheat       │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                              DATA LAYER                                         │
  ├─────────────────────────────────────────────────────────────────────────────────┤
  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
  │  │   PostgreSQL        │  │   Redis Cluster     │  │   Message Queue     │     │
  │  │                     │  │                     │  │                     │     │
  │  │  - Master/Slave     │  │  - Cache Layer      │  │  - Background Jobs  │     │
  │  │  - Partitioning     │  │  - Session Store    │  │  - Event Sourcing   │     │
  │  │  - Backup/Recovery  │  │  - Pub/Sub          │  │  - Notifications    │     │
  │  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
  └─────────────────────────────────────────────────────────────────────────────────┘