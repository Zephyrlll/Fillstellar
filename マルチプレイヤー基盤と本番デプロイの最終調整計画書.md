マルチプレイヤー基盤を制作する。細分化して行う。

*1 マルチプレイヤーアーキテクチャ設計
Cosmic Gardenerのマルチプレイヤー機能を設計。

現在の状況:
- シングルプレイヤーのゲームロジック実装済み
- WebSocket通信基盤構築済み
- 各プレイヤーが独自の銀河を持つ

マルチプレイヤー要件:
1. 銀河間の訪問・探索
2. プレイヤー間の貿易システム
3. 協力イベント（今後実装予定）
4. ランキング・リーダーボード
5. 非同期的な相互作用

設計検討項目:
- データ分離戦略（プライバシー考慮）
- 銀河間通信プロトコル
- 同期と非同期の使い分け
- スケーラビリティ


*2 プレイヤー間の経済システムについて詳細設計

要件:
1. リソース取引所（オーダーブック）
2. 価格の自動調整メカニズム
3. 取引の原子性保証
4. 不正取引の防止
5. 経済バランスの維持

実装の技術的詳細も含めてください。

期待する成果物:
マルチプレイヤーシステムの全体図
データモデルの拡張設計
通信プロトコルの仕様
セキュリティ考慮事項




*3 プレイヤー間通信システム
プレイヤー間の基本的な通信機能を実装。

実装内容:
1. プレイヤー発見システム
   - 近隣の銀河検索
   - プレイヤープロフィール
   - オンライン状態管理

2. メッセージングシステム
   - プレイヤー間メッセージ
   - システム通知
   - 取引リクエスト

3. 銀河訪問機能
   - 他プレイヤーの銀河を閲覧
   - 権限管理（公開/限定公開/非公開）
   - 訪問ログ

実装ファイル:
- src/multiplayer/discovery.rs
- src/multiplayer/messaging.rs
- src/multiplayer/permissions.rs

具体的な実装例:
rust// プレイヤー検索API
pub async fn search_nearby_players(
    pool: web::Data<PgPool>,
    user_id: Uuid,
    range: f64,
) -> Result<Vec<PlayerInfo>, ApiError> {
    // 実装
}

// メッセージ送信
pub async fn send_message(
    pool: web::Data<PgPool>,
    sender_id: Uuid,
    message: PlayerMessage,
) -> Result<(), ApiError> {
    // 実装
}




*4 貿易システム実装
プレイヤー間の貿易システムを実装。

1. 取引所システム
   - 売り注文/買い注文の管理
   - マッチングエンジン
   - 約定処理
   - 取引履歴

2. リソース転送
   - 原子性の保証（トランザクション）
   - 転送制限（レート制限）
   - 手数料システム

3. 価格発見メカニズム
   - 市場価格の計算
   - 価格履歴の保存
   - 統計情報API

データベーススキーマ:
- trade_orders テーブル
- trade_history テーブル
- market_prices テーブル




*5 ランキングシステム
グローバルランキングシステムを実装。

要件:
1. ランキングカテゴリ
   - 総資産ランキング
   - 天体数ランキング
   - 文明レベルランキング
   - 週間/月間ランキング

2. 効率的な集計
   - Redisでのリアルタイム更新
   - 定期的なバッチ集計
   - キャッシング戦略

3. API実装
   - GET /api/rankings/{category}
   - GET /api/rankings/player/{id}
   - WebSocketでのリアルタイム更新

パフォーマンスを考慮した実装にすること。



*6 セキュリティとバランス調整（Opus 4使用）
実装したマルチプレイヤー機能のセキュリティ監査をお願いします。

懸念事項:
1. 取引システムでの不正行為
2. 他プレイヤーへのDoS攻撃
3. データの不正取得
4. 経済システムの悪用

また、以下のゲームバランス問題について対策を提案してください：
- 初心者と上級者の格差
- リソースのインフレーション
- 独占的な市場支配
