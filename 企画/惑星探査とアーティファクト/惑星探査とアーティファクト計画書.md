# 惑星探査とアーティファクト計画書

## 1. はじめに

本ドキュメントは、「Cosmic Gardener」に探索の楽しみとユニークな報酬システムを追加する「惑星探査とアーティファクト」機能に関する計画を定義するものである。

### 1.1. 目的

本機能は、以下の目的のために導入する。

-   **探索要素の強化**: プレイヤーに広大な宇宙を積極的に探索する動機付けを与える。
-   **ユニークな報酬の提供**: 通常の資源や技術とは異なる、ゲームプレイに永続的な影響を与える特別なアイテム「アーティファクト」を導入する。
-   **コレクション要素の追加**: アーティファクトを収集すること自体を長期的な目標とし、コンプリートする楽しみを提供する。
-   **世界観の断片的な提示**: 発見されるアーティファクトのフレーバーテキストを通じて、宇宙に存在した古代文明や謎めいた現象の物語を断片的に描き、プレイヤーの想像力を刺激する。

## 2. 機能要件

### 2.1. 惑星探査

-   プレイヤーは「探査ドローン」を建造し、それを惑星や小惑星帯などの天体に派遣することで探査を行える。
-   探査には一定の時間と、少量のエネルギーコストがかかる。
-   各天体には、探査が完了するまで隠されている「探査ポイント」が存在する。

### 2.2. アーティファクト

-   **定義**: 宇宙の創造主、あるいは古代の超文明によって残された、物理法則を捻じ曲げる力を持つ遺物。
-   **発見**: 惑星探査が完了した際に、低確率でアーティファクトが発見されることがある。
-   **効果**:
    -   アーティファクトは、一度発見すると永続的にプレイヤーの宇宙全体にパッシブ効果をもたらす。
    -   効果は、資源生産量の上昇、研究速度の向上、新しい建造物のアンロックなど多岐にわたる。
    -   効果は強力だが、ゲームバランスを破壊しないよう慎重に調整される。
-   **重複**: 同じアーティファクトを複数発見することはできない。

### 2.3. アーティファクトの例

| アーティファクト名 | フレーバーテキスト | パッシブ効果 |
| :--- | :--- | :--- |
| **創生のコマ** | 「それは回すたびに、無から有を生み出したという。最初の神々が遊んだ玩具のようだ。」 | 全ての資源の基礎生産量が永続的に+1%される。 |
| **時間の結晶** | 「凍てついた時間の破片。内部には、過ぎ去ったはずの未来の光景が映り込んでいる。」 | 研究速度が永続的に+2%される。 |
| **生命のタペストリー** | 「あらゆる遺伝子情報が、この一枚の布に織り込まれているという。生命の設計図そのものだ。」 | 新しい生命が誕生する確率がわずかに上昇し、進化に必要なバイオマスが5%減少する。 |
| **忘れられた星図** | 「誰が、いつ、何のために描いたのか。しかし、そこにはまだ誰も知らない星々の位置が記されている。」 | 新たな天体を創造する際のエネルギーコストが3%減少する。 |
| **アインシュタインの羅針盤**| 「重力とは空間の歪みではない、とそれは指し示す。むしろ、空間こそが重力の影なのだと。」 | ブラックホールのダークマター生成効率が5%上昇する。 |

### 2.4. UI/UX

-   **アーティファクト博物館**:
    -   メニューに「アーティファクト」または「博物館」という項目を追加する。
    -   発見したアーティファクトがギャラリー形式で陳列される。
    -   各アーティファクトを選択すると、3Dモデル、フレーバーテキスト、および効果の詳細を確認できる。
    -   未発見のアーティファクトは「？？？」としてシルエットで表示され、収集意欲を刺激する。
-   **発見演出**:
    -   アーティファクト発見時には、特別な演出とサウンドエフェクトが再生され、プレイヤーに大きな達成感を与える。

## 3. 技術仕様

### 3.1. データベース設計

**1. `artifacts` (アーティファクトマスターテーブル)**

| カラム名 | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | `SERIAL PRIMARY KEY` | アーティファクトID |
| `name` | `VARCHAR(100)` | アーティファクト名 |
| `flavor_text` | `TEXT` | フレーバーテキスト |
| `effects` | `JSONB` | パッシブ効果の定義 (例: `{ "modifier": "global_production_boost", "value": 0.01 }`) |
| `icon_path` | `VARCHAR(255)` | アイコンのパス |
| `model_path` | `VARCHAR(255)` | 3Dモデルのパス |

**2. `user_artifacts` (ユーザーのアーティファクト発見記録)**

| カラム名 | 型 | 説明 |
| :--- | :--- | :--- |
| `user_id` | `INTEGER` | ユーザーID |
| `artifact_id` | `INTEGER` | 発見したアーティファクトID |
| `discovered_at` | `TIMESTAMP WITH TIME ZONE` | 発見日時 |

(PRIMARY KEY (`user_id`, `artifact_id`))

### 3.2. バックエンド (Rust / Actix Web)

-   **探査ロジック**:
    -   探査ドローンの派遣、探査時間の管理、完了処理を行うサービスを実装する。
    -   探査完了時に、アーティファクトの発見確率計算を行う。
-   **効果の適用**:
    -   `game_state` の計算ロジックに、発見済みの全アーティファクトのパッシブ効果を組み込む。
    -   生産量計算やコスト計算など、様々な箇所で効果が適用されるため、効果を管理する専用のモジュールを設けるのが望ましい。
-   **APIエンドポイント**:
    -   `POST /api/exploration/start`: 惑星探査を開始する。
    -   `GET /api/artifacts`: ユーザーが発見済みのアーティファクト一覧を返す。

### 3.3. フロントエンド (TypeScript / Three.js)

-   **探査管理UI**:
    -   惑星を選択した際に、探査ドローンを派遣するためのUIを追加する。
-   **アーティファクト博物館UI**:
    -   発見済み・未発見のアーティファクトを一覧表示する専用画面を作成する。
    -   `three.js` を用いて、アーティファクトの3Dモデルをインタラクティブに表示するビューワーを実装する。

## 4. 開発計画

### 4.1. タスク分割

-   **フェーズ1: バックエンド実装** (見積もり: 6人日)
    -   [ ] DBテーブル設計とマスターデータ投入
    -   [ ] 探査ロジックとアーティファクト発見判定の実装
    -   [ ] アーティファクト効果をゲーム状態に適用するロジックの実装
    -   [ ] APIエンドポイントの実装
-   **フェーズ2: フロントエンド実装** (見積もり: 5人日)
    -   [ ] 探査管理UIの実装
    -   [ ] アーティファクト博物館画面のUI実装
    -   [ ] アーティファクト発見時の演出実装
-   **フェーズ3: コンテンツ作成とテスト** (見積もり: 4人日)
    -   [ ] 初期実装として15～20種類のアーティファクトのデータ（効果、テキスト）を作成
    -   [ ] アーティファクトの3Dモデルとアイコンを作成
    -   [ ] 全体のバランス調整とテスト

### 4.2. マイルストーン

-   **マイルストーン1 (1.5週目)**: バックエンド実装完了。APIを通じて探査とアーティファクト発見が可能になる。
-   **マイルストーン2 (2.5週目)**: フロントエンド実装完了。UIから探査を行い、博物館で結果を確認できる。
-   **マイルストーン3 (3週目)**: コンテンツ作成完了。リリース可能な品質になる。

## 5. 将来の展望

-   **アーティファクトセット**: 特定の組み合わせのアーティファクトを揃えることで、追加の「セットボーナス」が発生する。
-   **アクティブ能力**: 発見したアーティファクトに、クールダウン付きの強力なアクティブ能力を追加する。
-   **失われた文明の遺跡**: 探査でアーティファクトだけでなく、特別なストーリーを持つ「遺跡」を発見できるようにする。遺跡は一連のクエストやパズルを提供する。 