# 統計・分析ダッシュボード 設計書

## 1. 概要と目的

本ドキュメントは、ゲーム「Cosmic Gardener」に実装する「統計・分析ダッシュボード」の設計について記述するものである。
このダッシュボードは、プレイヤーが自身のゲーム進行状況を詳細に把握し、より戦略的なプレイを行えるように支援することを目的とする。また、開発チームがプレイヤーの行動データを分析し、ゲームバランスの調整や将来のコンテンツ開発に役立てるための基盤ともなる。

## 2. ターゲットユーザー

*   **プレイヤー:**
    *   自身の生産効率やリソースの推移を確認したい。
    *   ゲーム内での進捗や達成項目を可視化したい。
    *   より効率的なプレイスタイルを模索したい。
*   **開発・運営チーム:**
    *   プレイヤーの行動パターンを分析したい。
    *   ゲームバランスが意図通りに機能しているか確認したい。
    *   新規コンテンツの導入影響を測定したい。

## 3. 主な機能と表示項目

ダッシュボードは、複数のタブで情報を整理し、プレイヤーが必要な情報に素早くアクセスできるようにする。

### 3.1. サマリータブ

プレイヤーの現在の状況を一覧できる総合的なダッシュボード。

*   **主要リソースの現在所持数と毎秒の生産量/消費量:**
    *   エネルギー, 宇宙の塵, ダークマター, バイオマス, 有機物, 思考ポイントなど
*   **ゲーム進行状況のハイライト:**
    *   総プレイ時間
    *   生成した天体の総数
    *   アンロック済みの技術数
*   **最近の重要な実績/マイルストーン**

### 3.2. リソースタブ

リソースに特化した詳細な分析データを表示。

*   **各リソースの時系列グラフ:**
    *   生産量、消費量、備蓄量の推移を時間軸（例: 過去1時間、24時間、7日間）で表示。
    *   グラフはズームイン/ズームアウトや期間指定が可能。
*   **リソース生産源の内訳:**
    *   どの天体や施設がどのリソースをどれだけ生産しているかの円グラフまたは棒グラフ。
*   **リソース消費先の内訳:**
    *   変換エンジンや研究などでどのリソースがどれだけ消費されているかの円グラフまたは棒グラフ。

### 3.3. 天体タブ

生成した天体に関する情報を表示。

*   **天体リスト:**
    *   生成した天体の一覧と、各種パラメータ（サイズ、質量、リソース生産量など）。
    *   ソート、フィルタリング機能。
*   **天体ごとの生産貢献度:**
    *   各天体がゲーム全体の総生産量にどれだけ貢献しているかのランキング。

### 3.4. 生産・変換タブ

変換エンジンなどの生産施設に関する効率分析。

*   **変換レシピごとの実行回数と効率:**
    *   どの変換レシピが最も利用されているか。
    *   リソース投入量に対する産出量の効率分析。
*   **アイドリング時間:**
    *   生産施設が稼働していない時間の割合。

## 4. UI/UX デザイン案

*   **レイアウト:**
    *   画面下部のパネルからアクセス可能。
    *   左側にナビゲーション用のタブ（サマリー, リソース, 天体, 生産）を配置。
    *   右側のメインエリアに選択されたタブのコンテンツ（グラフ、表など）を表示。
*   **インタラクション:**
    *   グラフ上のデータポイントにマウスオーバーすると詳細な数値が表示される。
    *   表データはCSV形式でエクスポート可能（プレイヤー向け・開発者向け）。
    *   UIは既存のゲームのテーマに沿った、未来的で洗練されたデザインを採用する。

## 5. 技術的実装計画

### 5.1. フロントエンド

*   **データ可視化ライブラリ:**
    *   `Chart.js` や `D3.js` などを利用して、動的でインタラクティブなグラフを描画する。
*   **状態管理:**
    *   既存のフロントエンドの状態管理システム（`state.js`）と連携し、リアルタイムでデータを更新する。
*   **コンポーネント化:**
    *   各タブやグラフを再利用可能なコンポーネントとして実装し、メンテナンス性を高める。

### 5.2. バックエンド

*   **APIエンドポイント:**
    *   統計データを取得するための専用APIエンドポイント（例: `/api/v1/stats/:category`）を設ける。
    *   リクエストに応じて、必要な集計データをJSON形式で返す。
*   **データ集計・処理:**
    *   **リアルタイムデータ:** 現在のゲーム状態から直接計算して提供。
    *   **時系列データ:** 定期的に（例: 1分ごと、10分ごと）ゲーム状態のスナップショットを新しいテーブル（例: `resource_time_series`）に保存する。APIリクエスト時にはこの集計済みテーブルからデータを取得することで、パフォーマンスの低下を防ぐ。
    *   データ集計処理は、バックグラウンドジョブとして実装し、ゲームループへの影響を最小限に抑える。
*   **キャッシュ:**
    *   頻繁にアクセスされるが更新頻度が低いデータ（例: 過去24時間の統計）は、Redisなどのインメモリキャッシュを利用して高速に応応答できるようにする。

### 5.3. データベース

*   **新規テーブルの設計:**
    *   `resource_time_series`:
        *   `player_id`: プレイヤーID
        *   `timestamp`: タイムスタンプ
        *   `resource_id`: リソースID
        *   `production_rate`: 生産量
        *   `consumption_rate`: 消費量
        *   `balance`: 残高
    *   `achievement_log`:
        *   `player_id`: プレイヤーID
        *   `achievement_id`: 実績ID
        *   `unlocked_at`: 達成日時
