# 研究ツリー拡張（超次元科学）計画書

## 1. はじめに

本ドキュメントは、「Cosmic Gardener」のエンドゲームコンテンツを拡充し、長期的なプレイ目標を提供するための「研究ツリー拡張（超次元科学）」に関する計画を定義するものである。

### 1.1. 目的

本機能は、以下の目的のために導入する。

-   **エンドゲームコンテンツの提供**: 通常の技術ツリーをすべて解放したプレイヤーに対し、新たな挑戦と目標を提供する。
-   **ゲームプレイの深化**: 既存のゲームメカニクスを根底から覆すような、強力でユニークな技術を導入し、ゲームプレイに新たな次元をもたらす。
-   **超長期的プレイヤーの維持**: 数週間から数ヶ月単位でプレイを続ける熱心なプレイヤーを惹きつけ、コミュニティの核とする。
-   **世界観の拡張**: ゲームの舞台を多次元宇宙へと広げ、より壮大な物語性を感じさせる。

## 2. 機能要件

### 2.1. 「超次元科学」ツリーの解放条件

-   既存の技術研究ツリーをすべて完了する。
-   特定の「ブレークスルー」プロジェクトを完了する。このプロジェクトには、膨大な量の思考ポイントと、エンドゲーム資源（例：ダークマターの凝縮体）が必要となる。

### 2.2. 新規追加リソース

超次元科学の研究には、既存のリソースに加えて、新たな特殊リソースが必要となる。

| リソース名 | 入手方法 | 用途 |
| :--- | :--- | :--- |
| **時空の裂け目** | ブラックホールを特定のエネルギーレベルで安定させると確率で出現。 | 超次元ゲートの建設、研究の基礎素材。 |
| **異次元物質** | 超次元ゲートを通じて、別の宇宙から取り寄せられる物質。 | 新たな施設の建設や、超次元技術の研究に必須。 |
| **宇宙の法則の断片**| ダイソンスフィア級の建造物から、宇宙背景放射を解析して稀に得られる。 | 非常に強力な効果を持つ「パラダイムシフト」研究に使用。 |

### 2.3. 研究項目の例

| 研究カテゴリ | 研究名 | 効果 | 必要リソース |
| :--- | :--- | :--- | :--- |
| **時空工学** | ワームホール航法 | 宇宙内の2点間を瞬時に移動できる「ワームホールゲート」を建設可能になる。 | 時空の裂け目, 異次元物質 |
| **因果律操作**| リソース遡及変換 | 一定時間、資源の変換効率を過去の最大効率に固定できる。 | 宇宙の法則の断片 |
| **高次元物理学**| ポケットユニバース | 資源を貯蔵するための、時間の流れが遅い小さな別次元を作成する。実質的に貯蔵庫の上限が撤廃される。 | 異次元物質 |
| **存在論的創造**| 概念創造 | 「エネルギー」や「物質」といった概念そのものを直接生成する究極の建造物を設置できる。 | 全ての特殊リソース |

### 2.4. UI/UX

-   既存の研究画面に、新たに「超次元科学」タブを追加する。
-   ツリーのデザインは、既存のものとは一線を画し、コズミックホラーや神秘的なモチーフを取り入れた、より抽象的で理解しがたい雰囲気のデザインとする。
-   各研究ノードは、完了するまで効果が不明な「？」アイコンで表示されるものも存在し、探求の楽しみを演出する。

## 3. 技術仕様

### 3.1. データベース設計

**`research_nodes`テーブルにカラム追加 or 新テーブル**

-   既存の`research_nodes`テーブルを拡張し、`tier`や`category`で超次元科学を区別できるようにする。
-   `is_hyperscience` (BOOLEAN) といったフラグを追加する。
-   新規リソースは既存の`resources`テーブルに追加する。

### 3.2. バックエンド (Rust / Actix Web)

-   **研究ロジックの拡張**:
    -   `research_service.rs`に、新たなリソース要件と研究効果を処理するロジックを追加。
    -   「ワームホール」や「ポケットユニバース」のような、既存のルールを根本的に変える機能の実装には、`physics`や`game_state`ロジックの大幅な見直しが必要となる可能性がある。
-   **パフォーマンス考慮**:
    -   エンドゲームではオブジェクト数が膨大になるため、新規技術による計算負荷の増大を常に監視し、最適化を行う必要がある。特に、全域に影響を及ぼすような効果については、慎重な設計が求められる。

### 3.3. フロントエンド (TypeScript / Three.js)

-   **研究ツリーUI**:
    -   「超次元科学」用の新しいUIコンポーネントを作成する。SVGやCanvasを用いて、動的でインタラクティブなツリーを描画する。
-   **新規リソースと施設の可視化**:
    -   時空の裂け目や超次元ゲートなど、新しいオブジェクトの3Dモデルとエフェクトを作成する。

## 4. 開発計画

### 4.1. タスク分割

-   **フェーズ1: 基本設計とバックエンド拡張** (見積もり: 8人日)
    -   [ ] DBスキーマの更新と新規リソース定義
    -   [ ] 研究サービスのロジック拡張
    -   [ ] 超次元科学ツリー解放条件の実装
    -   [ ] 比較的単純な効果を持つ研究項目の実装（例：資源生産量アップグレード）
-   **フェーズ2: フロントエンド実装** (見積もり: 6人日)
    -   [ ] 超次元科学タブと研究ツリーUIの基本骨格を実装
    -   [ ] 新規リソースのUI表示
    -   [ ] バックエンドとのAPI連携
-   **フェーズ3: 高度な機能とコンテンツ作成** (見積もり: 10人日)
    -   [ ] ワームホール、ポケットユニバースなどの複雑なゲームロジックを持つ研究の実装
    -   [ ] 新規3Dモデル、エフェクト、サウンドの追加
    -   [ ] 全研究項目のデータ作成とバランス調整
-   **フェーズ4: テストと最適化** (見積もり: 5人日)
    -   [ ] エンドゲーム状態でのパフォーマンステスト
    -   [ ] E2Eテストとリファクタリング

### 4.2. マイルストーン

-   **マイルストーン1 (2週目)**: バックエンド拡張完了。API経由で基本的な超次元科学の研究が可能になる。
-   **マイルストーン2 (3週目)**: フロントエンド実装完了。UI上で超次元科学ツリーが表示され、研究が行える。
-   **マイルストーン3 (5週目)**: 全ての機能とコンテンツ実装完了。内部テストが可能な状態になる。
-   **マイルストーン4 (6週目)**: テストと最適化完了。リリース可能な品質になる。

## 5. 将来の展望

-   **さらなるツリー拡張**: 新たなテーマ（例：「生命工学の極致」「精神エネルギー」）で、さらなる研究ツリーを追加する。
-   **敵対的次元**: 超次元ゲートを通じて、敵対的な存在が出現するイベントや、防衛要素を追加する。
-   **マルチプレイヤーとの連携**: 特定の研究を完了させると、他プレイヤーの宇宙に影響を与えたり、協力したりできる機能。 