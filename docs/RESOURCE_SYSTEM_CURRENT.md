# Cosmic Gardener - 現在のリソースシステム詳細仕様

## 概要

Cosmic Gardenerのリソースシステムは、2024年7月10日に大幅に拡張され、従来の6つの基本リソースから27種類の高度なリソースシステムに進化しました。品質システム、変換エンジン、生産施設を含む包括的な生産チェーンを実装しています。

## 基本構造

### 1. リソース種類（ResourceType）

#### 基本リソース（6種類）
```typescript
COSMIC_DUST        // 宇宙の塵 - 宇宙の基本的な構成要素
ENERGY            // エネルギー - 星や反応から収集
ORGANIC_MATTER    // 有機物 - 生命支援惑星から
BIOMASS           // バイオマス - 進化した生命体から
DARK_MATTER       // ダークマター - 特別な資源
THOUGHT_POINTS    // 思考ポイント - 知的文明から
```

#### 高度なリソース（21種類）
各基本リソースから4つの特化型に細分化：

**宇宙塵派生（4種）:**
- `IRON_DUST` - 鉄質塵（建設用金属粒子）
- `CARBON_DUST` - 炭素塵（有機合成用）
- `SILICON_DUST` - 珪素塵（電子機器用結晶）
- `RARE_EARTH_DUST` - 希土類塵（先端技術用希少元素）

**エネルギー派生（4種）:**
- `THERMAL_ENERGY` - 熱エネルギー（基本プロセス用）
- `ELECTRIC_ENERGY` - 電気エネルギー（精密作業用）
- `NUCLEAR_ENERGY` - 核エネルギー（大規模プロジェクト用）
- `QUANTUM_ENERGY` - 量子エネルギー（異次元技術用）

**有機物派生（4種）:**
- `SIMPLE_ORGANICS` - 単純有機物（基本有機分子）
- `COMPLEX_ORGANICS` - 複合有機物（高度な有機化合物）
- `GENETIC_MATERIAL` - 遺伝物質（生命操作用DNA・RNA）
- `ENZYMES` - 酵素（生物学的触媒）

**バイオマス派生（4種）:**
- `MICROBIAL_BIOMASS` - 微生物バイオマス（顕微鏡生物）
- `PLANT_BIOMASS` - 植物バイオマス（光合成生物）
- `ANIMAL_BIOMASS` - 動物バイオマス（移動生物）
- `INTELLIGENT_BIOMASS` - 知的バイオマス（知覚生物）

**ダークマター派生（4種）:**
- `STABLE_DARK_MATTER` - 安定ダークマター（安定形態）
- `VOLATILE_DARK_MATTER` - 不安定ダークマター（不安定粒子）
- `EXOTIC_DARK_MATTER` - 異次元ダークマター（奇妙な変異）
- `PRIMORDIAL_DARK_MATTER` - 原始ダークマター（ビッグバン由来）

**思考派生（4種）:**
- `BASIC_THOUGHTS` - 基本思考（単純な認知パターン）
- `CREATIVE_THOUGHTS` - 創造思考（想像的概念）
- `SCIENTIFIC_THOUGHTS` - 科学思考（分析的推論）
- `PHILOSOPHICAL_THOUGHTS` - 哲学思考（深い熟考）

#### 加工リソース（6種類）
```typescript
PROCESSED_METAL   // 加工金属 - 精製された金属材料
SILICON          // シリコン - 半導体材料
ALLOY            // 合金 - 高度な複合材料
```

### 2. 品質システム（QualityTier）

5段階の品質階層で各リソースを評価：

```typescript
enum QualityTier {
    POOR = 0        // 粗悪品（効率50%, 灰色）
    STANDARD = 1    // 標準品（効率100%, 白色）
    HIGH_QUALITY = 2 // 高品質（効率150%, 青色）
    PERFECT = 3     // 完璧品（効率200%, 紫色）
    LEGENDARY = 4   // 伝説品（効率300%, 金色）
}
```

**品質効果:**
- **効率倍率**: 生産・変換時の効果量
- **価値倍率**: 取引・研究での価値
- **視覚効果**: 色分け・発光・パーティクル
- **処理速度**: 高品質入力は処理時間短縮

### 3. リソースストレージ

```typescript
interface ResourceStorage {
    [resourceType: string]: {
        amount: number;         // 保有量
        quality: QualityTier;   // 品質（加重平均）
        accumulator: number;    // 小数点蓄積
        capacity?: number;      // 保管上限（未実装）
        degradationRate?: number; // 劣化率（未実装）
    }
}
```

## 変換システム

### 1. 変換レシピ（ConversionRecipe）

現在15種類のレシピが実装済み：

#### 基本金属加工
```typescript
'processed_metal_basic': {
    inputs: [宇宙の塵 100, エネルギー 50]
    outputs: [加工金属 10]
    time: 10秒, efficiency: 100%
}
```

#### 塵分離
```typescript
'dust_separation': {
    inputs: [宇宙の塵 1000, エネルギー 100]
    outputs: [鉄質塵 400, 炭素塵 300, 珪素塵 200, 希土類塵 50]
    time: 30秒, efficiency: 95%
    requirements: ['advanced_separation']
}
```

#### エネルギー変換チェーン
```typescript
熱変換: エネルギー → 熱エネルギー (120%, 5秒)
電気変換: 熱エネルギー → 電気エネルギー (80%, 8秒)
核融合: 電気エネルギー 1000 + 加工金属 10 → 核エネルギー 500 (50%, 120秒)
```

#### 有機物処理
```typescript
有機合成: 炭素塵 50 + 有機物 100 + エネルギー 25 → 複合有機物 75
酵素培養: 有機物 200 + バイオマス 50 → 酵素 25
```

#### バイオマス進化
```typescript
バイオマス培養: 有機物 100 + エネルギー 20 → 微生物バイオマス 50
バイオマス進化: 微生物バイオマス 100 + 遺伝物質 10 → 植物バイオマス 30
```

#### 高度な変換
```typescript
合金鍛造: 加工金属 50 + 希土類塵 10 + 核エネルギー 100 → 高品質合金 20
品質強化: 標準加工金属 100 + 量子エネルギー 50 → 高品質加工金属 50
```

### 2. 変換エンジン（ConversionEngine）

#### 主要機能
- **リソース充足チェック**: `canAffordRecipe()`
- **変換プロセス管理**: 開始・進捗・完了
- **施設効率計算**: 施設レベル・タイプによる効率ボーナス
- **自動モード**: 施設の自動連続生産
- **品質計算**: 入力品質による出力品質向上

#### 変換プロセス
1. **リソース消費**: 必要リソースを即座に差し引き
2. **時間管理**: リアルタイム進捗追跡
3. **品質計算**: 入力品質→出力品質・効率補正
4. **アウトプット生成**: 完了時にリソース追加

### 3. 生産施設（ProductionFacility）

#### 基本コンバーター
```typescript
'basic_converter': {
    name: 'Basic Resource Converter'
    type: 'converter'
    recipes: ['processed_metal_basic', 'silicon_extraction', ...]
    level: 1, efficiency: 1.0
    autoMode: false  // 手動/自動切り替え
}
```

#### 施設タイプ
- **converter**: 汎用変換施設
- **extractor**: 資源抽出施設
- **refinery**: 精製施設
- **synthesizer**: 合成施設

## UI システム

### 生産タブ構成

#### 1. 高度な資源表示
- **カテゴリ別分類**: 塵派生、エネルギー派生、等
- **品質視覚化**: 色分け・発光効果
- **動的更新**: 0.1秒間隔

#### 2. 変換レシピリスト
- **利用可能レシピ**: 技術・施設要件チェック
- **リソース充足表示**: 緑（充足）/赤（不足）
- **ワンクリック変換**: 即座に変換開始

#### 3. アクティブ変換
- **進捗バー**: リアルタイム進捗
- **残り時間**: 秒単位カウントダウン
- **施設情報**: 使用中施設名

#### 4. 生産施設管理
- **施設ステータス**: 稼働中・待機・停止
- **自動モード**: ON/OFF切り替え
- **効率表示**: レベル・効率値

## データ構造と保存

### ゲーム状態への統合
```typescript
gameState.advancedResources: ResourceStorage  // 高度リソース保管
gameState.discoveredTechnologies: Set<string> // 発見済み技術
gameState.availableFacilities: Set<string>    // 利用可能施設
gameState.conversionEngine: ConversionEngineState // エンジン状態
```

### セーブ・ロード
- **自動保存**: gameState統合により既存システム活用
- **状態復元**: アクティブ変換・施設状態復元
- **バージョニング**: 下位互換性維持

## パフォーマンス最適化

### UI更新最適化
- **更新間隔制限**: 0.1秒間隔でUI更新
- **ダーティチェック**: 変更時のみDOM更新
- **カテゴリ分類**: 効率的な表示グループ化

### 計算最適化
- **品質計算キャッシュ**: 重複計算回避
- **効率算出**: 一回計算・再利用
- **メモリ管理**: 不要オブジェクト削除

### 視覚効果
- **パーティクルシステム**: 品質別発光効果
- **色分けシステム**: 品質・カテゴリ別配色
- **レスポンシブUI**: 動的レイアウト調整

## 既知の制限・課題

### 現在の制限事項
1. **技術要件システム**: レシピ解放条件は実装済みだが、技術研究システム未連携
2. **施設建設**: 施設は初期状態で固定、建設・アップグレード未実装
3. **リソース上限**: 容量制限システム未実装
4. **劣化システム**: 時間経過による品質劣化未実装
5. **取引システム**: プレイヤー間・NPC取引未実装

### パフォーマンス課題
1. **大量リソース処理**: 数千単位での処理時の負荷
2. **同時変換制限**: 複数同時変換時のUI負荷
3. **品質計算複雑性**: 多重品質混合時の算出コスト

### UI/UX改善点
1. **レシピ検索**: フィルタ・ソート機能不足
2. **チュートリアル**: 複雑システムの説明不足
3. **効率最適化支援**: 最適生産ルート提案機能なし
4. **統計表示**: 生産効率・利益率分析機能不足

## 拡張可能性

### 短期拡張候補
1. **新レシピ追加**: 既存フレームワークで容易
2. **施設多様化**: タイプ別特殊能力
3. **品質強化**: より高品質への変換ルート
4. **自動化改善**: 生産チェーン全体の自動化

### 長期拡張候補
1. **地域特性**: 天体別リソース特性
2. **市場システム**: 価格変動・需給バランス
3. **研究ツリー**: 技術進歩による新機能解放
4. **協力システム**: プレイヤー間リソース交換

この仕様書は2024年7月10日時点の実装状況を反映しており、今後の調整・拡張の基準資料として使用できます。