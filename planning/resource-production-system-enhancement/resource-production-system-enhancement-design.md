# 資源・生産システム強化設計書 v2.0

## 1. はじめに

本ドキュメントは、「Cosmic Gardener」の経済と生産システムに、より深い戦略性と管理の楽しみを導入するための、大規模な強化案について記述するものである。この強化により、プレイヤーは単なる資源収集者から、宇宙規模の産業帝国を築く戦略家へと成長する。

### 1.1. 目的

本強化の目的は以下の通りである。

-   **戦略性の深化**: 単純な直線的生産から、多角的な判断が求められる複雑な生産網（サプライチェーン）の構築へとゲームプレイを進化させる。
-   **プレイヤーの創造性を刺激**: プレイヤーが独自の効率的な生産ラインやコンボを発見する楽しみを提供する。
-   **中盤以降のゲームプレイの拡張**: ゲーム中盤からの「やること」を増やし、最適化の無限の可能性を提供することで、長期的なエンゲージメントを高める。
-   **より現実的な宇宙経済のシミュレート**: 資源の価値や希少性が状況によって変動する、動的な経済システムの基礎を築く。
-   **エマージェントゲームプレイの促進**: システム間の相互作用から予想外の戦略や発見が生まれる環境を構築する。
-   **アクセシビリティの確保**: 複雑さを段階的に開示し、初心者から上級者まで楽しめる設計とする。

## 2. コアコンセプト

今回の強化は、以下の7つの柱を軸に展開される。

1.  **資源の階層化 (Resource Tiering)**: 資源に「Tier（階層）」の概念を導入。高次のTierの資源ほど、強力な効果を持つが、複雑な生産工程を必要とする。
2.  **副産物と廃棄物 (Byproducts & Waste)**: 生産活動が主産物だけでなく、価値ある「副産物」や、放置するとペナルティがある「廃棄物」を生み出す。
3.  **モジュール式生産施設 (Modular Facilities)**: 建造物を単一機能の箱ではなく、様々な「モジュール」を装着して性能をカスタマイズできるプラットフォームとして再定義する。
4.  **触媒システム (Catalyst System)**: 特定の生産プロセスに「触媒」を投入することで、一時的に生産効率を劇的に向上させたり、特殊な結果を生み出したりする。
5.  **生産チェーンの可視化 (Production Chain Visualization)**: 複雑な生産網をフローチャートで視覚的に表示し、ボトルネックや効率改善点を直感的に把握できるようにする。
6.  **市場と取引システム (Market & Trading)**: NPC文明との取引や、資源価格の変動を導入し、生産計画に経済的判断を加える。
7.  **自動化とロジスティクス (Automation & Logistics)**: 資源の輸送、在庫管理、生産の自動調整など、産業帝国の運営を支援するシステム。

---

## 3. 詳細設計

### 3.1. 資源の階層化と精製

-   **概要**: 既存の資源を「Tier 1」とし、それらを複数組み合わせ、多段階の精製プロセスを経て「Tier 2」「Tier 3」の高度な資源を生み出す。
-   **例**:
    -   **エネルギーの階層化**
        -   **Tier 1: 生エネルギー (Raw Energy)**: 恒星などから得られる基本的なエネルギー。
        -   **Tier 2: 安定化エネルギー (Stabilized Energy)**: 「エネルギー安定化装置」で生エネルギーを変換。貯蔵効率が高く、高度な施設の動力源となる。
        -   **Tier 3: 濃縮エネルギー (Condensed Energy)**: 安定化エネルギーを重力レンズで圧縮。兵器や超次元科学の研究など、瞬間的に莫大なエネルギーを要する用途に使う。
    -   **物質の階層化**
        -   **Tier 1: 宇宙の塵 (Cosmic Dust)**
        -   **Tier 2: 精製金属 (Refined Metals)**: 宇宙の塵を「電磁遠心分離機」で精製。建造物の基本資材。
        -   **Tier 3: 超合金 (Super-Alloys)**: 精製金属に特殊なガスを加えて「高圧合成炉」で生成。耐久性の高い特殊な施設の建材となる。

### 3.2. 副産物と廃棄物処理

-   **概要**: 生産施設が、設定されたレシピに基づいて、主産物とは別に副産物や廃棄物を生成する。
-   **副産物の例**:
    -   `宇宙の塵` → `精製金属` の精製プロセスで、低確率で `希少元素` が副産物として得られる。希少元素はモジュール作成などに必要。
    -   `バイオマス` → `有機物` の分解プロセスで、`メタンガス` が副産物として発生。メタンガスは低効率ながらエネルギー源として再利用可能。
-   **廃棄物の例**:
    -   `生エネルギー` → `安定化エネルギー` の変換時に `放射性廃棄物` が発生。
    -   **管理**: 廃棄物は専用の「廃棄物貯蔵庫」に保管する必要がある。貯蔵庫が満杯になると、周辺施設の生産効率が低下したり、惑星の環境に悪影響を及ぼしたりする。
    -   **処理**: 「リサイクル施設」を建設して廃棄物を無害な物質に変換するか、「マスドライバー」で宇宙の彼方へ射出する（ただしコストがかかる）などの対策が必要。

### 3.3. モジュール式生産施設

-   **概要**: 多くの生産施設に「モジュールスロット」が設けられる。プレイヤーは、研究開発によってアンロックした様々なモジュールをスロットに装着し、施設の性能を特化させることができる。
-   **モジュールの例**:
    -   **効率モジュール**: 消費電力や原材料を削減する。
    -   **速度モジュール**: 生産速度を向上させるが、消費電力が増加する。
    -   **生産性モジュール**: 生産速度がわずかに落ちる代わりに、一定時間ごとに追加の製品を無償で生み出す。
    -   **品質向上モジュール**: （品質の概念がある場合）生産物の品質を向上させる。
    -   **副産物フィルタリングモジュール**: 副産物の産出確率を上げる、または特定の副産物を狙って抽出する。

### 3.4. 触媒システム

-   **概要**: 特定の生産プロセスに、消耗品である「触媒」を投入する。触媒が消費されている間、その施設は特別なブースト効果を得る。
-   **触媒の例**:
    -   **プラズマ触媒**: エネルギー変換施設に使用すると、30分間、変換効率が200%になるが、施設の耐久度（または寿命）をわずかに消費する。
    -   **自己組織化ナノマシン**: 建造物に使用すると、建設速度を10倍にする。
    -   **生命の種子**: 惑星のテラフォーミング時に使用すると、生命が誕生する確率を大幅に引き上げる。

## 4. 新規リソース・建造物案

### 4.1. 資源階層一覧

#### Tier 1（基礎資源）
| 名前 | 説明 | 用途 |
| :--- | :--- | :--- |
| 宇宙の塵 | 最も基本的な物質資源 | 基礎建材、精製原料 |
| 生エネルギー | 恒星から得られる未処理エネルギー | 施設の動力、変換原料 |
| 有機物 | 生命由来の基礎物質 | バイオ系製品の原料 |
| バイオマス | 生物の集合体 | 生命系リソースの基礎 |
| ダークマター | 神秘的な物質 | 特殊技術の基礎 |

#### Tier 2（加工資源）
| 名前 | 説明 | 必要素材 |
| :--- | :--- | :--- |
| 安定化エネルギー | 貯蔵・転送可能なエネルギー | 生エネルギー x3 |
| 精製金属 | 高純度の金属素材 | 宇宙の塵 x5 |
| 希少元素 | 特殊な性質を持つ元素 | 精製金属の副産物 |
| 高分子ポリマー | 高度な有機素材 | 有機物 x3 + 触媒 |
| 量子結晶 | 量子状態を保持する結晶 | ダークマター x2 + エネルギー |

#### Tier 3（高度資源）
| 名前 | 説明 | 必要素材 |
| :--- | :--- | :--- |
| 濃縮エネルギー | 超高密度エネルギー | 安定化エネルギー x10 |
| 超合金 | 極限環境に耐える素材 | 精製金属 x5 + 希少元素 x2 |
| ナノマシン | 自己組織化・修復能力 | 高分子ポリマー x3 + 量子結晶 |
| 思考結晶 | 情報・意識を保存 | 思考ポイント x100 + 量子結晶 x3 |
| 時空繊維 | 時空間を操作する素材 | ダークマター x10 + 濃縮エネルギー x5 |

### 4.2. 新規建造物

#### 生産施設
| 名前 | 説明 | モジュールスロット |
| :--- | :--- | :--- |
| エネルギー安定化装置 | 生エネルギーを安定化 | 2スロット |
| 電磁遠心分離機 | 宇宙の塵から金属を抽出 | 3スロット |
| 高圧合成炉 | 超合金などを作成 | 4スロット |
| 量子凝縮器 | 量子結晶を生成 | 3スロット |
| ナノファブリケーター | ナノマシン製造 | 5スロット |
| 時空織機 | 時空繊維を紡ぐ | 6スロット |

#### 支援施設
| 名前 | 説明 | 機能 |
| :--- | :--- | :--- |
| 廃棄物貯蔵庫 | 廃棄物を安全に保管 | 容量1000単位 |
| リサイクル施設 | 廃棄物を再利用可能に | 処理速度10/分 |
| モジュール製造工場 | 各種モジュールを作成 | 同時3個製造可 |
| 輸送ハブ | 資源輸送を管理 | 10ルート管理 |
| 市場ターミナル | NPCとの取引拠点 | 5取引同時実行 |
| 研究所 | 新技術の開発 | 研究速度+50% |

### 4.3. モジュール一覧

#### 基本モジュール
| 名前 | 効果 | コスト |
| :--- | :--- | :--- |
| 効率モジュールMk1 | 消費資源-15% | 希少元素 x5 |
| 速度モジュールMk1 | 生産速度+25%、消費+50% | 希少元素 x5 |
| 品質モジュールMk1 | 品質+1、速度-10% | 希少元素 x8 |
| 副産物モジュール | 副産物率+10% | 希少元素 x10 |

#### 上級モジュール
| 名前 | 効果 | コスト |
| :--- | :--- | :--- |
| 効率モジュールMk2 | 消費資源-30% | 量子結晶 x3 |
| 速度モジュールMk2 | 生産速度+50%、消費+75% | 量子結晶 x3 |
| 品質モジュールMk2 | 品質+2、速度-15% | 量子結晶 x5 |
| 廃棄物削減モジュール | 廃棄物-50% | ナノマシン x2 |
| 自動最適化モジュール | AIが生産を自動調整 | 思考結晶 x1 |

### 4.4. 触媒一覧

| 名前 | 効果 | 持続時間 | コスト |
| :--- | :--- | :--- | :--- |
| プラズマ触媒 | 変換効率200% | 30分 | 安定化エネルギー x10 |
| ナノ触媒 | 建設速度10倍 | 10分 | ナノマシン x1 |
| 生命の種子 | 生命誕生率+50% | 1時間 | 有機物 x100 |
| 量子触媒 | 全生産+100% | 15分 | 量子結晶 x5 |
| 時間加速触媒 | 時間を2倍速 | 5分 | 時空繊維 x1 |

## 5. UI/UXへの影響

### 5.1. 新規UI要素

#### 生産管理画面
-   **資源階層表示**: Tier別に色分けされた資源アイコン
-   **生産フロービュー**: 資源の流れをリアルタイムで可視化
-   **副産物/廃棄物パネル**: 
    -   生産率と貯蔵状況のグラフ表示
    -   廃棄物警告システム（貯蔵庫80%で黄色、95%で赤色警告）
    -   ワンクリック廃棄物処理ボタン

#### 施設管理画面
-   **モジュールスロットUI**:
    -   3D表示のスロットにモジュールをドラッグ＆ドロップ
    -   モジュール効果のリアルタイムプレビュー
    -   モジュールの相性表示（相乗効果や競合の警告）
-   **触媒投入UI**:
    -   タイマー付き触媒スロット
    -   触媒効果の波紋エフェクト
    -   残り時間のプログレスバー

#### 生産チェーンビュー
-   **フローチャート表示**:
    -   ノードとエッジで施設と資源の流れを表現
    -   ボトルネックの色分け表示（緑:余裕、黄:注意、赤:警告）
    -   ズーム/パン機能で詳細確認
-   **最適化アシスタント**:
    -   AIの提案をオーバーレイ表示
    -   ワンクリックで提案を適用

### 5.2. 情報の段階的開示

1. **初心者モード**: 基本的な生産情報のみ表示
2. **中級者モード**: 副産物、モジュール情報を追加
3. **上級者モード**: 全情報、詳細な統計、最適化ツール

### 5.3. ブループリントシステムの拡張

-   **モジュール構成の保存**: 施設ごとのモジュール配置を記録
-   **生産チェーンテンプレート**: 効率的な生産ラインのパターンを保存
-   **コミュニティ共有**: 他プレイヤーのブループリントをインポート

### 5.4. アクセシビリティ機能

-   **カラーブラインドモード**: 色覚異常に対応した配色
-   **キーボードショートカット**: 主要操作のキーバインド
-   **スクリーンリーダー対応**: ARIAラベルの適切な設定

### 3.5. 生産チェーンの可視化

-   **概要**: プレイヤーが構築した生産網を、インタラクティブなフローチャートとして表示する専用ビュー。
-   **機能**:
    -   **ノード表示**: 各施設が資源の流れを示すノードとして表示される。
    -   **フロー表示**: 資源の流れが動的なアニメーションで表示され、ボトルネックが一目で分かる。
    -   **効率指標**: 各ノードの稼働率、待機時間、在庫状況などがリアルタイムで表示される。
    -   **最適化提案**: AIが生産チェーンを分析し、改善提案を表示する。

### 3.6. 市場と取引システム

-   **概要**: 宇宙には複数のNPC文明が存在し、それぞれが異なる資源を求めている。プレイヤーは市場価格を見ながら取引を行える。
-   **市場メカニクス**:
    -   **需給バランス**: 各文明の需要と供給により価格が変動する。
    -   **距離による輸送コスト**: 遠い文明との取引は輸送コストがかかる。
    -   **評判システム**: 継続的な取引により評判が上がり、特別な取引が解禁される。
    -   **先物取引**: 将来の資源を現在の価格で契約できる。

### 3.7. 自動化とロジスティクス

-   **概要**: 中盤以降、プレイヤーは生産管理の多くを自動化できるようになる。
-   **自動化要素**:
    -   **スマート在庫管理**: 設定した閾値に基づいて自動的に生産を調整。
    -   **輸送ネットワーク**: 資源を自動的に必要な場所へ輸送するドローンやシャトル。
    -   **生産優先度システム**: 資源不足時の生産優先順位を事前設定。
    -   **緊急時プロトコル**: 廃棄物溢れや資源枯渇時の自動対応。

## 6. 実装への考察

-   **バックエンド**:
    -   レシピのデータ構造を拡張し、複数のアウトプット（主産物、副産物、廃棄物）と、それらの確率を定義できるようにする必要がある。
    -   建造物の状態管理に、モジュールスロットと装着されているモジュールの情報を追加する。
    -   触媒のような時限的ブーストを管理する、効率的なステータス効果システムが必要になる。
-   **パフォーマンス**:
    -   生産チェーンが複雑化することによる計算負荷の増大に注意が必要。特に、多数の施設の状態を毎秒更新するロジックは最適化が必須となる。
-   **段階的導入**:
    -   全ての要素を一度に導入するのではなく、「資源の階層化」→「モジュールシステム」のように、段階的にリリースすることで、プレイヤーが新システムに慣れる時間を作るのが望ましい。

## 7. 実装ロードマップ

### Phase 1: 基礎システム（1-2ヶ月）
-   資源の階層化（Tier 1-2のみ）
-   基本的な副産物システム
-   シンプルな生産チェーン可視化

### Phase 2: 拡張システム（2-3ヶ月）
-   Tier 3資源の追加
-   廃棄物処理システム
-   モジュール式生産施設（基本モジュールのみ）

### Phase 3: 高度なシステム（3-4ヶ月）
-   触媒システム
-   市場と取引システム
-   高度なモジュールの追加

### Phase 4: 自動化と最適化（4-5ヶ月）
-   自動化システム全般
-   ロジスティクスネットワーク
-   AI最適化提案機能

## 8. プレイヤーオンボーディング戦略

### 8.1. チュートリアルシステム
-   **段階的解禁**: 新機能はプレイヤーの進行度に応じて段階的に解禁
-   **インタラクティブガイド**: 実際に操作しながら学べるハンズオンチュートリアル
-   **ヒントシステム**: 困っているプレイヤーに文脈に応じたヒントを表示


## 9. バランス調整ガイドライン

### 9.1. 資源変換レート
-   Tier 1 → Tier 2: 3:1～5:1の比率
-   Tier 2 → Tier 3: 5:1～10:1の比率
-   副産物発生率: 5%～20%（モジュールで強化可能）

### 9.2. 廃棄物ペナルティ
-   初期段階: 生産効率-5%～-10%
-   中期段階: 生産効率-10%～-20%、環境への影響
-   後期段階: カスケード効果による連鎖的な問題

### 9.3. モジュール効果
-   効率モジュール: 消費-15%～-30%
-   速度モジュール: 生産速度+25%～+50%、消費+50%～+100%
-   品質モジュール: 品質+1～+2レベル、速度-10%～-20%

## 10. 技術仕様

### 10.1. データ構造の拡張
```typescript
interface ProductionRecipe {
  id: string;
  inputs: ResourceRequirement[];
  outputs: {
    primary: ResourceOutput;
    byproducts?: ResourceOutput[];
    waste?: ResourceOutput[];
  };
  duration: number;
  energyConsumption: number;
  catalysts?: CatalystOption[];
}

interface Facility {
  id: string;
  type: FacilityType;
  moduleSlots: ModuleSlot[];
  currentRecipe?: ProductionRecipe;
  efficiency: number;
  status: FacilityStatus;
}
```

### 10.2. パフォーマンス最適化
-   **バッチ処理**: 生産計算を1秒ごとにバッチで実行
-   **キャッシング**: 生産チェーンの依存関係をキャッシュ
-   **WebWorker活用**: 重い計算処理をメインスレッドから分離
-   **差分更新**: UIは変更があった部分のみを更新

## 11. 将来の拡張可能性

-   **研究ツリーとの統合**: 新しい生産技術の研究開発
-   **イベントシステム**: 市場クラッシュ、資源ラッシュなどの経済イベント
-   **マルチプレイヤー取引**: プレイヤー間での資源取引
-   **産業特化**: 特定の産業に特化した文明の構築 