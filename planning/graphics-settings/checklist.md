# グラフィックス設定機能 実装チェックリスト

このチェックリストは、「グラフィックス設定機能 設計書」に基づいています。

## 1. 設定データ構造の実装 (`state.js`)
- [ ] `state.js` に `graphics` オブジェクトを追加する
- [ ] `graphics` オブジェクト内に、設計書で定義されたすべての設定項目のデフォルト値を設定する
- [ ] `graphics` オブジェクト内に、`performance` と `deviceInfo` オブジェクトのプレースホルダを追加する
- [ ] 設計書に基づいた `GRAPHICS_PRESETS` 定数を定義する（ultra, high, medium, low, minimal）

## 2. パフォーマンス監視システムの実装
- [ ] FPS（フレームレート）測定機能を実装する
- [ ] 描画時間（フレームタイム）測定機能を実装する
- [ ] メモリ使用量監視機能を実装する
- [ ] GPU使用率測定機能を実装する（可能な範囲で）
- [ ] `state.graphics.performance` オブジェクトに測定結果をリアルタイムで更新する
- [ ] パフォーマンス履歴の記録機能を実装する
- [ ] GPUベンダーやレンダラー名を取得するデバイス情報収集機能を実装する
- [ ] `state.graphics.deviceInfo` オブジェクトに収集した情報を格納する

## 3. UIの実装 (`ui.js`, HTML/CSS)
- [ ] グラフィックス設定画面のモーダルウィンドウのHTML/CSSを作成する
- [ ] 設計書に記載の各設定項目に対応するUI要素（ドロップダウン、スライダー、トグル等）を作成する
- [ ] パフォーマンス指標（FPSなど）を表示するエリアをUI上に追加する
- [ ] UIの操作を検知し、`state.graphics` の値を更新するイベントリスナーを `ui.js` に実装する
- [ ] プリセット選択時に、関連するすべての設定UIを一度に更新するロジックを実装する
- [ ] ユーザーが個別の設定を変更した際に、プリセット表示を「カスタム」に切り替えるロジックを実装する

## 4. 設定適用ロジックの実装 (レンダリングエンジン連携)
- [ ] `state.graphics` の変更を監視し、対応するレンダリング設定を適用する仕組みを構築する
- [ ] **解像度スケール**: `renderer.setDrawingBufferSize()` または `renderer.setSize()` を呼び出して解像度を変更するロジックを実装する
- [ ] **テクスチャ品質**: 高/中/低解像度のテクスチャを動的にロードし、マテリアルに適用するロジックを実装する
- [ ] **シャドウ品質**: `renderer.shadowMap.type` やライトの `shadow.mapSize` を変更するロジックを実装する
- [ ] **アンチエイリアシング**: レンダラーの `antialias` プロパティを更新する（場合によってはレンダラー再生成）ロジックを実装する
- [ ] **ポストプロセッシング**: `EffectComposer` のパスを追加・削除・更新するロジックを実装する
- [ ] **パーティクル密度**: パーティクルエミッターの放出レートを変更するロジックを実装する
- [ ] **描画距離**: カメラの `far` プロパティを更新するロジックを実装する
- [ ] **フレームレート上限**: `requestAnimationFrame` の呼び出しを制御してFPSを制限するロジックを実装する
- [ ] **垂直同期 (V-Sync)**: レンダラー生成時に設定を適用するロジックを実装する
- [ ] **ライティング品質**: ライトの数や種類、計算の複雑さを変更するロジックを実装する
- [ ] **フォグ効果**: `scene.fog` の有効/無効やパラメータを変更するロジックを実装する
- [ ] **レンダリング精度**: レンダラーの精度設定を変更するロジックを実装する
- [ ] **オブジェクト詳細度 (LOD)**: `THREE.LOD` を使用して天体オブジェクトのLODシステムを実装する
- [ ] **星雲・星座表示**: 背景描画の品質を切り替えるロジックを実装する
- [ ] **UI アニメーション**: CSSクラスを切り替えてUIアニメーションのオン/オフを制御する

## 5. プリセットシステムの実装
- [ ] UIでプリセットが選択された際に、`GRAPHICS_PRESETS` に基づいて `state.graphics` を一括更新する機能を実装する
- [ ] デバイス情報に基づいて、初回起動時に推奨プリセットを自動選択・適用する機能を実装する

## 6. 設定の永続化 (`saveload.js`)
- [ ] `saveload.js` に `graphics` 設定を `localStorage` に保存する機能を追加する
- [ ] ゲーム起動時に `localStorage` から `graphics` 設定を読み込み、`state` に復元する機能を追加する

## 7. テストと品質保証
- [ ] **機能テスト**:
    - [ ] すべての設定項目がグラフィックスに正しく反映されることを確認する
    - [ ] プリセットの切り替えが正しく動作することを確認する
    - [ ] 設定がリロード後も維持されることを確認する
- [ ] **パフォーマンステスト**:
    - [ ] 「ultra」と「minimal」プリセットでFPSに明確な差が出ることを測定・確認する
    - [ ] 設定変更によるメモリリークがないかプロファイリングする
- [ ] **互換性テスト**:
    - [ ] 主要なデスクトップブラウザ（Chrome, Firefox, Safari, Edge）で動作確認を行う
    - [ ] 主要なモバイルブラウザ（iOS Safari, Android Chrome）で動作確認とUIの表示確認を行う

## 8. （将来拡張）高度な機能
- [ ] **動的品質調整機能の実装**:
    - [ ] フレームレート監視機能を実装する
    - [ ] FPS低下検知時の自動設定下げ機能を実装する
    - [ ] 設定復帰時のスムーズな品質向上機能を実装する
- [ ] **設定のエクスポート/インポート機能**:
    - [ ] カスタムプリセットをJSON形式でエクスポートする機能を実装する
    - [ ] エクスポートしたプリセットをインポートする機能を実装する
    - [ ] 短縮URLでの設定共有機能を実装する
- [ ] **画面モード設定**:
    - [ ] フルスクリーン/ウィンドウモード切替機能を実装する
    - [ ] ディスプレイ解像度プリセット機能を実装する
- [ ] **アクセシビリティ対応**:
    - [ ] キーボード操作サポートを実装する
    - [ ] スクリーンリーダー対応を実装する
    - [ ] ハイコントラストモード対応を実装する
